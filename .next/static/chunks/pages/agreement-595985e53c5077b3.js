(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7567],{7894:function(e,r,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/agreement",function(){return t(3351)}])},1097:function(e,r,t){"use strict";t.d(r,{Z:function(){return c}});var s=t(5893),n=t(7294),a=t(8790),l=t(163),o=t(2779),i=t(8865);function c(e){let{onSignatureChange:r,label:t="Your Signature",required:c=!1,disabled:d=!1}=e,u=(0,n.useRef)(null),[m,h]=(0,n.useState)(!0),[x,g]=(0,n.useState)(null);(0,n.useEffect)(()=>{u.current&&u.current.on()},[]);let p=()=>{if(u.current&&!u.current.isEmpty()){let e=u.current.toDataURL("image/png");g(e),h(!1),r&&r(e)}};return(0,s.jsxs)("div",{className:"w-full",children:[(0,s.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[t,c&&(0,s.jsx)("span",{className:"text-red-500 ml-1",children:"*"})]}),(0,s.jsxs)("div",{className:"border-2 border-gray-300 rounded-lg bg-white signature-pad-container",children:[(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(a.Z,{ref:u,canvasProps:{width:500,height:200,className:"signature-canvas w-full h-40 sm:h-48 rounded-t-lg",style:{border:"none",background:d?"#f9fafb":"white",touchAction:"none"}},onEnd:()=>{u.current&&!u.current.isEmpty()&&p()},backgroundColor:d?"#f9fafb":"white",penColor:d?"#d1d5db":"#000000",disabled:d}),m&&!d&&(0,s.jsx)("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:(0,s.jsx)("p",{className:"text-gray-400 text-xs sm:text-sm text-center px-4",children:"Sign here with your mouse or finger"})}),d&&(0,s.jsx)("div",{className:"absolute inset-0 bg-gray-100 bg-opacity-50 flex items-center justify-center",children:(0,s.jsx)("p",{className:"text-gray-500 text-xs sm:text-sm text-center px-4",children:"Signature pad disabled"})})]}),(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 sm:gap-0 p-3 bg-gray-50 border-t border-gray-200 rounded-b-lg",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsxs)("button",{type:"button",onClick:()=>{u.current&&(u.current.clear(),h(!0),g(null),r&&r(null))},disabled:d||m,className:"flex items-center px-3 py-2 text-xs sm:text-sm text-gray-600 hover:text-gray-800 disabled:opacity-50 disabled:cursor-not-allowed min-h-[44px] rounded",children:[(0,s.jsx)(l.Z,{className:"h-4 w-4 mr-1"}),"Clear"]}),x&&(0,s.jsxs)("button",{type:"button",onClick:()=>{if(x){let e=document.createElement("a");e.download="signature.png",e.href=x,document.body.appendChild(e),e.click(),document.body.removeChild(e)}},className:"flex items-center px-3 py-2 text-xs sm:text-sm text-blue-600 hover:text-blue-800 min-h-[44px] rounded",children:[(0,s.jsx)(o.Z,{className:"h-4 w-4 mr-1"}),"Download"]})]}),(0,s.jsx)("div",{className:"flex items-center",children:!m&&(0,s.jsxs)("div",{className:"flex items-center text-green-600 text-xs sm:text-sm",children:[(0,s.jsx)(i.Z,{className:"h-4 w-4 mr-1"}),(0,s.jsx)("span",{className:"hidden sm:inline",children:"Signature captured"}),(0,s.jsx)("span",{className:"sm:hidden",children:"Captured"})]})})]})]}),c&&m&&(0,s.jsx)("p",{className:"mt-1 text-sm text-red-600",children:"Signature is required"}),(0,s.jsxs)("p",{className:"mt-2 text-xs text-gray-500 leading-relaxed",children:[(0,s.jsx)("span",{className:"hidden sm:inline",children:"Use your mouse or finger to draw your signature in the box above."}),(0,s.jsx)("span",{className:"sm:hidden",children:"Draw your signature with your finger in the box above."})," ","You can clear and redraw if needed."]})]})}},7298:function(e,r,t){"use strict";t.d(r,{KO:function(){return o},L$:function(){return c},oN:function(){return a},sN:function(){return n},t7:function(){return l},zy:function(){return i}});var s=t(9495);let n=async function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5;try{let t=await e.arrayBuffer(),n=await s.PDFDocument.load(t),a=n.getPageCount(),l=Math.ceil(a/r),o=[];for(let e=0;e<r;e++){let r=e*l,t=Math.min(r+l-1,a-1);if(r<a){let a=await s.PDFDocument.create();for(let e=r;e<=t;e++){let[r]=await a.copyPages(n,[e]);a.addPage(r)}let l=await a.save();o.push({sectionNumber:e+1,title:"Section ".concat(e+1," (Pages ").concat(r+1,"-").concat(t+1,")"),content:l,pageRange:"".concat(r+1,"-").concat(t+1),totalPages:t-r+1})}}return{sections:o,error:null}}catch(e){return console.error("Error splitting PDF:",e),{sections:null,error:e}}},a=async(e,r)=>{try{console.log("Starting PDF sections upload...");let{data:{session:t}}=await r.auth.getSession();if(!(null==t?void 0:t.access_token))throw Error("No authentication token available");console.log("Session token available, preparing upload...");let s={sections:e.map(r=>({title:r.title,section_number:r.sectionNumber,total_sections:e.length,content:Array.from(new Uint8Array(r.content))}))};console.log("Sending request to upload API...");let n=await fetch("/api/admin/upload-sections",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t.access_token)},body:JSON.stringify(s)});if(console.log("Upload API response status:",n.status),!n.ok){let e="Failed to upload sections";try{let r=await n.json();e=r.error||e,console.error("Upload API error:",r)}catch(t){let r=await n.text();console.error("Upload API returned non-JSON response:",r),e=r.includes("<html>")||r.includes("<!DOCTYPE")?"Server returned HTML instead of JSON. Check server logs for authentication issues.":"Server error: ".concat(n.status," ").concat(n.statusText)}throw Error(e)}let a=await n.json();return console.log("Upload successful:",a),{sections:a.sections,error:null}}catch(e){return console.error("Error uploading sections:",e),{sections:null,error:e}}},l=async e=>{try{if(!e)return{sections:[],error:null};let{data:r,error:t}=await e.from("pdf_sections").select("*").order("section_number");if(t)throw t;return{sections:r,error:null}}catch(e){return{sections:null,error:e}}},o=async(e,r)=>{try{if(console.log("Getting PDF URL for file path:",e),!e)return console.error("No file path provided"),null;let{data:t}=r.storage.from("pdf-sections").getPublicUrl(e);if(console.log("Generated public URL:",null==t?void 0:t.publicUrl),null==t?void 0:t.publicUrl)return console.log("Returning public URL:",t.publicUrl),t.publicUrl;return null}catch(e){return console.error("Error getting PDF URL:",e),null}},i=async(e,r,t)=>{try{if(console.log("Marking section complete:",{userId:e,sectionId:r}),!e||!r)throw Error("User ID and Section ID are required");let t=await fetch("/api/complete-section",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:e,sectionId:r})}),s=await t.json();if(!t.ok)throw Error(s.error||"Failed to complete section");return console.log("Section marked complete successfully:",s.data),{data:s.data,error:null}}catch(e){return console.error("Error marking section complete:",e),{data:null,error:e}}},c=async(e,r)=>{try{if(!r||!e)return{progress:[],error:null};console.log("Getting user progress for userId:",e);let{data:t,error:s}=await r.from("user_progress").select("\n        *,\n        pdf_sections (\n          id,\n          title,\n          section_number,\n          total_sections\n        )\n      ").eq("user_id",e);if(s)throw console.error("Error fetching user progress:",s),s;console.log("Raw progress data:",t);let n=(null==t?void 0:t.filter(e=>null!==e.pdf_sections))||[];return console.log("Valid progress data:",n),{progress:n,error:null}}catch(e){return console.error("getUserProgress error:",e),{progress:null,error:e}}}},3351:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return x}});var s=t(5893),n=t(7294),a=t(1163),l=t(4733),o=t(1097),i=t(1046),c=t(7298),d=t(2553),u=t(8267),m=t(1700),h=t(6501);function x(){let[e,r]=(0,n.useState)(null),[t,x]=(0,n.useState)({fullName:"",email:"",phone:"",address:"",dateOfBirth:"",emergencyContact:"",emergencyPhone:"",previousChurch:"",baptized:"",testimony:"",commitment:!1,agreement:!1}),[g,p]=(0,n.useState)(null),[f,y]=(0,n.useState)(!0),[b,j]=(0,n.useState)(!1),[N,v]=(0,n.useState)(!1),w=(0,a.useRouter)();(0,n.useEffect)(()=>{C()},[]);let C=async()=>{try{let e=await (0,i.ts)();if(!e){w.push("/auth/login");return}r(e);let{data:t,error:s}=await i.OQ.from("agreements").select("*").eq("user_id",e.id).single();if(t){w.push("/agreement-status");return}x(r=>{var t;return{...r,fullName:(null===(t=e.user_metadata)||void 0===t?void 0:t.full_name)||"",email:e.email||""}});let{sections:n}=await (0,c.t7)(i.OQ),{progress:a}=await (0,c.L$)(e.id,i.OQ),l=(null==n?void 0:n.length)||0;if(((null==a?void 0:a.filter(e=>e.completed).length)||0)<l){v(!1),h.default.error("Please complete all study sections before accessing the agreement"),w.push("/dashboard");return}v(!0)}catch(e){console.error("Error checking access:",e),h.default.error("Failed to load agreement page")}finally{y(!1)}},k=e=>{let{name:r,value:t,type:s,checked:n}=e.target;x(e=>({...e,[r]:"checkbox"===s?n:t}))},P=()=>{let e=["fullName","email","phone","address","dateOfBirth","emergencyContact","emergencyPhone"].filter(e=>!t[e]);return e.length>0?(h.default.error("Please fill in all required fields: ".concat(e.join(", "))),!1):t.commitment?t.agreement?!!g||(h.default.error("Please provide your signature"),!1):(h.default.error("Please agree to the terms and conditions"),!1):(h.default.error("Please confirm your commitment to the church"),!1)},S=async r=>{if(r.preventDefault(),P()){j(!0);try{console.log("Submitting form data:",t);let{data:r,error:s}=await i.OQ.from("agreements").insert({user_id:e.id,form_data:t,user_signature:g,status:"pending"}).select().single();if(s)throw s;h.default.success("Agreement submitted successfully!"),w.push("/agreement-status")}catch(e){console.error("Error submitting agreement:",e),h.default.error("Failed to submit agreement. Please try again.")}finally{j(!1)}}};return f?(0,s.jsx)(l.Z,{requireAuth:!0,children:(0,s.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,s.jsx)("div",{className:"loading-spinner"})})}):N?(0,s.jsx)(l.Z,{requireAuth:!0,children:(0,s.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,s.jsx)("div",{className:"bg-white shadow",children:(0,s.jsx)("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-4 sm:py-6",children:(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)(d.Z,{className:"h-6 w-6 sm:h-8 sm:w-8 text-church-primary mr-3 flex-shrink-0"}),(0,s.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,s.jsx)("h1",{className:"text-lg sm:text-xl lg:text-2xl font-bold text-gray-900 truncate",children:"NBCC Membership Agreement"}),(0,s.jsx)("p",{className:"text-xs sm:text-sm text-gray-500 mt-1",children:"Complete your membership by filling out this agreement"})]})]})})}),(0,s.jsx)("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:(0,s.jsxs)("form",{onSubmit:S,className:"space-y-8",children:[(0,s.jsxs)("div",{className:"bg-white shadow rounded-lg p-4 sm:p-6 form-section",children:[(0,s.jsxs)("h2",{className:"text-base sm:text-lg font-semibold text-gray-900 mb-4 sm:mb-6 flex items-center",children:[(0,s.jsx)(u.Z,{className:"h-4 w-4 sm:h-5 sm:w-5 mr-2 flex-shrink-0"}),"Personal Information"]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 sm:gap-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-xs sm:text-sm font-medium text-gray-700 mb-2",children:"Full Name *"}),(0,s.jsx)("input",{type:"text",name:"fullName",value:t.fullName,onChange:k,required:!0,className:"w-full px-3 py-3 sm:py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-church-primary focus:border-church-primary bg-white text-gray-900 text-base sm:text-sm"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-xs sm:text-sm font-medium text-gray-700 mb-2",children:"Email Address *"}),(0,s.jsx)("input",{type:"email",name:"email",value:t.email,onChange:k,required:!0,className:"w-full px-3 py-3 sm:py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-church-primary focus:border-church-primary text-base sm:text-sm"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-xs sm:text-sm font-medium text-gray-700 mb-2",children:"Phone Number *"}),(0,s.jsx)("input",{type:"tel",name:"phone",value:t.phone,onChange:k,required:!0,className:"w-full px-3 py-3 sm:py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-church-primary focus:border-church-primary text-base sm:text-sm"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-xs sm:text-sm font-medium text-gray-700 mb-2",children:"Date of Birth *"}),(0,s.jsx)("input",{type:"date",name:"dateOfBirth",value:t.dateOfBirth,onChange:k,required:!0,className:"w-full px-3 py-3 sm:py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-church-primary focus:border-church-primary text-base sm:text-sm"})]}),(0,s.jsxs)("div",{className:"md:col-span-2",children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Address *"}),(0,s.jsx)("textarea",{name:"address",value:t.address,onChange:k,required:!0,rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-church-primary focus:border-church-primary"})]})]})]}),(0,s.jsxs)("div",{className:"bg-white shadow rounded-lg p-6",children:[(0,s.jsxs)("h2",{className:"text-lg font-semibold text-gray-900 mb-6 flex items-center",children:[(0,s.jsx)(m.Z,{className:"h-5 w-5 mr-2"}),"Emergency Contact"]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Emergency Contact Name *"}),(0,s.jsx)("input",{type:"text",name:"emergencyContact",value:t.emergencyContact,onChange:k,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-church-primary focus:border-church-primary"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Emergency Contact Phone *"}),(0,s.jsx)("input",{type:"tel",name:"emergencyPhone",value:t.emergencyPhone,onChange:k,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-church-primary focus:border-church-primary"})]})]})]}),(0,s.jsxs)("div",{className:"bg-white shadow rounded-lg p-6",children:[(0,s.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-6",children:"Spiritual Background"}),(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Previous Church (if any)"}),(0,s.jsx)("input",{type:"text",name:"previousChurch",value:t.previousChurch,onChange:k,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-church-primary focus:border-church-primary"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Have you been baptized?"}),(0,s.jsxs)("select",{name:"baptized",value:t.baptized,onChange:k,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-church-primary focus:border-church-primary",children:[(0,s.jsx)("option",{value:"",children:"Please select"}),(0,s.jsx)("option",{value:"yes",children:"Yes"}),(0,s.jsx)("option",{value:"no",children:"No"}),(0,s.jsx)("option",{value:"planning",children:"Planning to be baptized"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Brief Testimony (Optional)"}),(0,s.jsx)("textarea",{name:"testimony",value:t.testimony,onChange:k,rows:4,placeholder:"Share your faith journey or testimony...",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-church-primary focus:border-church-primary"})]})]})]}),(0,s.jsxs)("div",{className:"bg-white shadow rounded-lg p-6",children:[(0,s.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-6",children:"Membership Commitments"}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex items-start",children:[(0,s.jsx)("input",{type:"checkbox",name:"commitment",checked:t.commitment,onChange:k,className:"mt-1 h-4 w-4 text-church-primary focus:ring-church-primary border-gray-300 rounded"}),(0,s.jsx)("label",{className:"ml-3 text-sm text-gray-700",children:"I commit to actively participate in the life of this church, including regular attendance, fellowship, service, and financial support as I am able. I understand the responsibilities and privileges of church membership as outlined in the study materials."})]}),(0,s.jsxs)("div",{className:"flex items-start",children:[(0,s.jsx)("input",{type:"checkbox",name:"agreement",checked:t.agreement,onChange:k,className:"mt-1 h-4 w-4 text-church-primary focus:ring-church-primary border-gray-300 rounded"}),(0,s.jsx)("label",{className:"ml-3 text-sm text-gray-700",children:"I agree to the church's statement of faith, constitution, and bylaws. I understand that this agreement represents my voluntary decision to join this church community."})]})]})]}),(0,s.jsxs)("div",{className:"bg-white shadow rounded-lg p-6",children:[(0,s.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-6",children:"Digital Signature"}),(0,s.jsx)(o.Z,{onSignatureChange:p,label:"Your Signature",required:!0}),(0,s.jsx)("p",{className:"mt-4 text-sm text-gray-600",children:"By signing above, I confirm that all information provided is accurate and that I voluntarily request membership in this church."})]}),(0,s.jsx)("div",{className:"flex justify-center",children:(0,s.jsx)("button",{type:"submit",disabled:b,className:"w-full sm:w-auto px-6 sm:px-8 py-3 sm:py-3 bg-church-primary text-white font-semibold rounded-lg hover:bg-church-secondary focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-church-primary disabled:opacity-50 disabled:cursor-not-allowed min-h-[44px] transition-colors duration-200 text-base sm:text-sm",children:b?(0,s.jsxs)("div",{className:"flex items-center justify-center",children:[(0,s.jsx)("div",{className:"loading-spinner w-5 h-5 mr-2"}),(0,s.jsx)("span",{children:"Submitting..."})]}):"Submit Membership Agreement"})})]})})]})}):null}}},function(e){e.O(0,[5285,9495,1998,4733,2888,9774,179],function(){return e(e.s=7894)}),_N_E=e.O()}]);