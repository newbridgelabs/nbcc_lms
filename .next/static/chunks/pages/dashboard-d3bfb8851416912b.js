(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8026],{1075:function(e,s,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/dashboard",function(){return t(4125)}])},3346:function(e,s,t){"use strict";t.d(s,{Z:function(){return r}});let r=(0,t(3759).Z)("Calendar",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}]])},39:function(e,s,t){"use strict";t.d(s,{Z:function(){return r}});let r=(0,t(3759).Z)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]])},5452:function(e,s,t){"use strict";t.d(s,{Z:function(){return r}});let r=(0,t(3759).Z)("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]])},5062:function(e,s,t){"use strict";t.d(s,{Z:function(){return r}});let r=(0,t(3759).Z)("Play",[["polygon",{points:"5 3 19 12 5 21 5 3",key:"191637"}]])},3283:function(e,s,t){"use strict";t.d(s,{Z:function(){return r}});let r=(0,t(3759).Z)("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]])},4125:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return v}});var r=t(5893),n=t(7294),i=t(1163),a=t(4733),l=t(4563),c=t(5452),o=t(3346),d=t(5062);function m(e){let{user:s}=e,[t,a]=(0,n.useState)([]),[l,m]=(0,n.useState)(!0),x=(0,i.useRouter)();(0,n.useEffect)(()=>{s&&u()},[s]);let u=async()=>{try{let e=await fetch("/api/sermons"),s=await e.json();if(e.ok){let e=(s.sermons||[]).sort((e,s)=>new Date(s.sermon_date)-new Date(e.sermon_date)).slice(0,3);a(e)}}catch(e){console.error("Error loading sermons:",e)}finally{m(!1)}},h=e=>new Date(e).toLocaleDateString("en-US",{month:"short",day:"numeric"});return l?(0,r.jsx)("div",{className:"bg-white shadow rounded-lg p-6",children:(0,r.jsxs)("div",{className:"animate-pulse",children:[(0,r.jsx)("div",{className:"h-4 bg-gray-200 rounded w-1/3 mb-4"}),(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsx)("div",{className:"h-3 bg-gray-200 rounded"}),(0,r.jsx)("div",{className:"h-3 bg-gray-200 rounded w-5/6"})]})]})}):0===t.length?(0,r.jsxs)("div",{className:"bg-white shadow rounded-lg p-6",children:[(0,r.jsxs)("div",{className:"flex items-center mb-4",children:[(0,r.jsx)(c.Z,{className:"h-5 w-5 text-church-primary mr-2"}),(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Sermon Notes"})]}),(0,r.jsxs)("div",{className:"text-center py-6",children:[(0,r.jsx)(c.Z,{className:"mx-auto h-8 w-8 text-gray-400 mb-2"}),(0,r.jsx)("p",{className:"text-sm text-gray-500",children:"No sermons available yet"})]})]}):(0,r.jsxs)("div",{className:"bg-white shadow rounded-lg p-6",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)(c.Z,{className:"h-5 w-5 text-church-primary mr-2"}),(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Recent Sermons"})]}),(0,r.jsx)("button",{onClick:()=>x.push("/sermons"),className:"text-sm text-church-primary hover:text-church-secondary font-medium",children:"View All"})]}),(0,r.jsx)("div",{className:"space-y-4",children:t.map(e=>{var s;return(0,r.jsx)("div",{className:"border border-gray-200 rounded-lg p-4 hover:border-church-primary transition-colors duration-200 cursor-pointer",onClick:()=>x.push("/sermons/".concat(e.id)),children:(0,r.jsxs)("div",{className:"flex items-start justify-between",children:[(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsx)("h4",{className:"text-sm font-medium text-gray-900 truncate",children:e.title}),(0,r.jsxs)("div",{className:"flex items-center mt-1 text-xs text-gray-500",children:[(0,r.jsx)(o.Z,{className:"h-3 w-3 mr-1"}),h(e.sermon_date),e.pastor_name&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("span",{className:"mx-2",children:"â€¢"}),e.pastor_name]})]}),(0,r.jsxs)("div",{className:"mt-2 text-xs text-gray-500",children:[(null===(s=e.sermon_questions)||void 0===s?void 0:s.length)||0," reflection points"]})]}),(0,r.jsx)("div",{className:"ml-4 flex-shrink-0",children:(0,r.jsx)("div",{className:"flex items-center justify-center w-8 h-8 bg-church-primary bg-opacity-10 rounded-full",children:(0,r.jsx)(d.Z,{className:"h-4 w-4 text-church-primary"})})})]})},e.id)})}),(0,r.jsx)("div",{className:"mt-4 pt-4 border-t border-gray-200",children:(0,r.jsxs)("button",{onClick:()=>x.push("/sermons"),className:"w-full inline-flex items-center justify-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-church-primary transition-colors duration-200",children:[(0,r.jsx)(c.Z,{className:"h-4 w-4 mr-2"}),"Take Sermon Notes"]})})]})}var x=t(1046),u=t(7298),h=t(1164),g=t(4976),f=t(3283),p=t(2089),y=t(39),j=t(493),N=t(2553),b=t(6501);function v(){var e;let[s,t]=(0,n.useState)(null),[o,d]=(0,n.useState)([]),[v,w]=(0,n.useState)([]),[k,S]=(0,n.useState)(null),[_,Z]=(0,n.useState)(!0),[C,P]=(0,n.useState)({completedSections:0,totalSections:0,progressPercentage:0}),E=(0,i.useRouter)();(0,n.useEffect)(()=>{A()},[]),(0,n.useEffect)(()=>{let e=()=>{document.hidden||(console.log("Page became visible, refreshing dashboard data..."),A())};return document.addEventListener("visibilitychange",e),()=>document.removeEventListener("visibilitychange",e)},[]);let A=async()=>{try{console.log("Loading dashboard data...");let e=await (0,x.ts)();if(!e){E.push("/auth/login");return}if(t(e),console.log("Current user:",e.id),await (0,h.Cn)(e.id,e.email)){console.log("User is admin, redirecting to admin dashboard"),E.push("/admin");return}let{sections:s,error:r}=await (0,u.t7)(x.OQ);r?(console.error("Error loading sections:",r),d([])):(d(s||[]),console.log("Loaded sections:",(null==s?void 0:s.length)||0));let{progress:n,error:i}=await (0,u.L$)(e.id,x.OQ);if(i)console.error("Error loading progress:",i),w([]),P({completedSections:0,totalSections:(null==s?void 0:s.length)||0,progressPercentage:0});else{let e=n||[];w(e),console.log("Loaded progress:",e.length,"entries"),console.log("Progress details:",e.map(e=>{var s,t;return{sectionId:e.section_id,sectionNumber:null===(s=e.pdf_sections)||void 0===s?void 0:s.section_number,completed:e.completed,title:null===(t=e.pdf_sections)||void 0===t?void 0:t.title}}));let t=e.filter(e=>e.completed&&e.pdf_sections).length,r=(null==s?void 0:s.length)||0,i=r>0?Math.round(t/r*100):0;console.log("Progress stats:",{completedCount:t,totalCount:r,percentage:i}),P({completedSections:t,totalSections:r,progressPercentage:i})}let{data:a,error:l}=await x.OQ.from("agreements").select("*").eq("user_id",e.id).single();a&&S(a)}catch(e){console.error("Error loading dashboard:",e),b.default.error("Failed to load dashboard data")}finally{Z(!1)}},L=e=>{"agreement"===e?k?E.push("/agreement-status"):E.push("/agreement"):E.push("/sections/".concat(e))},R=()=>{let e=v.filter(e=>e.completed&&e.pdf_sections).map(e=>e.section_id),s=o.find(s=>!e.includes(s.id));return console.log("Next section calculation:",{completedSectionIds:e,nextSection:null==s?void 0:s.section_number,totalSections:o.length}),s?s.section_number:null},q=async()=>{b.default.success("Refreshing progress..."),await A()};return _?(0,r.jsx)(a.Z,{requireAuth:!0,children:(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,r.jsx)("div",{className:"loading-spinner"})})}):(0,r.jsx)(a.Z,{requireAuth:!0,children:(0,r.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,r.jsx)("div",{className:"bg-white shadow",children:(0,r.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 sm:py-6",children:(0,r.jsxs)("div",{className:"md:flex md:items-center md:justify-between",children:[(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsxs)("h1",{className:"text-xl sm:text-2xl lg:text-3xl font-bold leading-7 text-gray-900 truncate",children:["Welcome back, ",(null==s?void 0:null===(e=s.user_metadata)||void 0===e?void 0:e.full_name)||(null==s?void 0:s.email)]}),(0,r.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:"Continue your journey to church membership"})]}),(0,r.jsx)("div",{className:"mt-4 flex md:mt-0 md:ml-4",children:(0,r.jsxs)("button",{onClick:q,disabled:_,className:"inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-church-primary disabled:opacity-50",children:[(0,r.jsx)(g.Z,{className:"h-4 w-4 mr-2 ".concat(_?"animate-spin":"")}),"Refresh Progress"]})})]})})}),(0,r.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 sm:py-8",children:0===o.length?(0,r.jsxs)("div",{className:"text-center py-8 sm:py-12",children:[(0,r.jsx)(f.Z,{className:"mx-auto h-10 w-10 sm:h-12 sm:w-12 text-gray-400"}),(0,r.jsx)("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No study materials available"}),(0,r.jsx)("p",{className:"mt-1 text-sm text-gray-500 px-4",children:"The church administrator needs to upload the study materials first."}),(0,r.jsx)("div",{className:"mt-6",children:(0,r.jsx)("button",{onClick:()=>window.location.reload(),className:"inline-flex items-center px-4 py-3 sm:py-2 border border-transparent shadow-sm text-base sm:text-sm font-medium rounded-md text-white bg-church-primary hover:bg-church-secondary focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-church-primary min-h-[44px]",children:"Refresh Page"})})]}):(0,r.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4 sm:gap-8",children:[(0,r.jsxs)("div",{className:"lg:col-span-2 space-y-4 sm:space-y-8",children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6 dashboard-stats",children:[(0,r.jsx)("div",{className:"bg-white overflow-hidden shadow rounded-lg",children:(0,r.jsx)("div",{className:"p-4 sm:p-5",children:(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("div",{className:"flex-shrink-0",children:(0,r.jsx)(p.Z,{className:"h-6 w-6 text-church-primary"})}),(0,r.jsx)("div",{className:"ml-3 sm:ml-5 w-0 flex-1",children:(0,r.jsxs)("dl",{children:[(0,r.jsx)("dt",{className:"text-xs sm:text-sm font-medium text-gray-500 truncate",children:"Sections Completed"}),(0,r.jsxs)("dd",{className:"text-lg sm:text-xl font-medium text-gray-900",children:[C.completedSections," / ",C.totalSections]})]})})]})})}),(0,r.jsx)("div",{className:"bg-white overflow-hidden shadow rounded-lg",children:(0,r.jsx)("div",{className:"p-4 sm:p-5",children:(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("div",{className:"flex-shrink-0",children:(0,r.jsx)(y.Z,{className:"h-6 w-6 text-yellow-600"})}),(0,r.jsx)("div",{className:"ml-3 sm:ml-5 w-0 flex-1",children:(0,r.jsxs)("dl",{children:[(0,r.jsx)("dt",{className:"text-xs sm:text-sm font-medium text-gray-500 truncate",children:"Progress"}),(0,r.jsxs)("dd",{className:"text-lg sm:text-xl font-medium text-gray-900",children:[C.progressPercentage,"%"]})]})})]})})}),(0,r.jsx)("div",{className:"bg-white overflow-hidden shadow rounded-lg",children:(0,r.jsx)("div",{className:"p-4 sm:p-5",children:(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("div",{className:"flex-shrink-0",children:C.completedSections===C.totalSections&&C.totalSections>0?(0,r.jsx)(j.Z,{className:"h-6 w-6 text-green-600"}):(0,r.jsx)(N.Z,{className:"h-6 w-6 text-gray-400"})}),(0,r.jsx)("div",{className:"ml-3 sm:ml-5 w-0 flex-1",children:(0,r.jsxs)("dl",{children:[(0,r.jsx)("dt",{className:"text-xs sm:text-sm font-medium text-gray-500 truncate",children:"Agreement"}),(0,r.jsx)("dd",{className:"text-lg sm:text-xl font-medium text-gray-900",children:k?"completed"===k.status?"Approved":"Pending":C.completedSections===C.totalSections&&C.totalSections>0?"Ready":"Locked"})]})})]})})})]}),(0,r.jsx)("div",{className:"bg-white shadow rounded-lg",children:(0,r.jsxs)("div",{className:"px-4 py-4 sm:py-5 sm:p-6",children:[(0,r.jsx)("h3",{className:"text-base sm:text-lg leading-6 font-medium text-gray-900 mb-4",children:"Quick Actions"}),(0,r.jsxs)("div",{className:"grid grid-cols-1 gap-3 sm:grid-cols-2 lg:grid-cols-4 sm:gap-4",children:[R()&&(0,r.jsxs)("button",{onClick:()=>L(R()),className:"inline-flex items-center justify-center px-4 py-3 sm:py-2 border border-transparent text-base sm:text-sm font-medium rounded-md text-white bg-church-primary hover:bg-church-secondary focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-church-primary min-h-[44px] w-full transition-colors duration-200",children:[(0,r.jsx)(p.Z,{className:"h-4 w-4 mr-2 flex-shrink-0"}),(0,r.jsxs)("span",{className:"truncate",children:["Continue Section ",R()]})]}),C.completedSections===C.totalSections&&C.totalSections>0&&(0,r.jsxs)("button",{onClick:()=>L("agreement"),className:"inline-flex items-center justify-center px-4 py-3 sm:py-2 border border-transparent text-base sm:text-sm font-medium rounded-md text-white focus:outline-none focus:ring-2 focus:ring-offset-2 min-h-[44px] w-full transition-colors duration-200 ".concat(k?"bg-blue-600 hover:bg-blue-700 focus:ring-blue-500":"bg-green-600 hover:bg-green-700 focus:ring-green-500"),children:[(0,r.jsx)(N.Z,{className:"h-4 w-4 mr-2 flex-shrink-0"}),(0,r.jsx)("span",{className:"truncate",children:k?"View Agreement Status":"Complete Agreement"})]}),(0,r.jsxs)("button",{onClick:()=>E.push("/sections/1"),className:"inline-flex items-center justify-center px-4 py-3 sm:py-2 border border-gray-300 text-base sm:text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-church-primary min-h-[44px] w-full transition-colors duration-200",children:[(0,r.jsx)(p.Z,{className:"h-4 w-4 mr-2 flex-shrink-0"}),(0,r.jsx)("span",{className:"truncate",children:"View All Sections"})]}),(0,r.jsxs)("button",{onClick:()=>E.push("/sermons"),className:"inline-flex items-center justify-center px-4 py-3 sm:py-2 border border-gray-300 text-base sm:text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-church-primary min-h-[44px] w-full transition-colors duration-200",children:[(0,r.jsx)(c.Z,{className:"h-4 w-4 mr-2 flex-shrink-0"}),(0,r.jsx)("span",{className:"truncate",children:"Sermon Notes"})]}),(0,r.jsxs)("button",{onClick:q,className:"inline-flex items-center justify-center px-4 py-3 sm:py-2 border border-gray-300 text-base sm:text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-church-primary min-h-[44px] w-full transition-colors duration-200",children:[(0,r.jsx)(g.Z,{className:"h-4 w-4 mr-2 flex-shrink-0"}),(0,r.jsx)("span",{className:"truncate",children:"Refresh Progress"})]})]})]})})]}),(0,r.jsxs)("div",{className:"space-y-4 sm:space-y-8",children:[(0,r.jsx)(l.Z,{sections:o,currentSection:R()||1,completedSections:v.filter(e=>e.completed&&e.pdf_sections).map(e=>e.pdf_sections.section_number),onSectionClick:L}),(0,r.jsx)(m,{user:s})]})]})})]})})}}},function(e){e.O(0,[5285,9495,4733,8522,2888,9774,179],function(){return e(e.s=1075)}),_N_E=e.O()}]);