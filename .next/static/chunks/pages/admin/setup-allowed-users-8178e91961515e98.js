(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[839],{2555:function(e,s,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/setup-allowed-users",function(){return a(9290)}])},3765:function(e,s,a){"use strict";a.d(s,{Z:function(){return t}});let t=(0,a(3759).Z)("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},2761:function(e,s,a){"use strict";a.d(s,{Z:function(){return t}});let t=(0,a(3759).Z)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},493:function(e,s,a){"use strict";a.d(s,{Z:function(){return t}});let t=(0,a(3759).Z)("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},9354:function(e,s,a){"use strict";a.d(s,{Z:function(){return t}});let t=(0,a(3759).Z)("Database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]])},9290:function(e,s,a){"use strict";a.r(s),a.d(s,{default:function(){return u}});var t=a(5893),l=a(7294),r=a(1163),n=a(4733),i=a(1046),c=a(2761),d=a(9354),o=a(493),m=a(3765),x=a(6501);function u(){let[e,s]=(0,l.useState)(null),[a,u]=(0,l.useState)(!1),h=(0,r.useRouter)(),b=async()=>{u(!0),s(null);try{console.log("Testing allowed_users table connection...");let{data:e,error:a}=await i.OQ.from("allowed_users").select("*").limit(1);if(console.log("Query result:",{data:e,error:a}),!a){s("success"),x.default.success("Allowed users table is working correctly!");return}a.message&&a.message.includes("does not exist")?(s("manual"),x.default.error("Table not found. Please run the SQL migration manually in Supabase SQL Editor")):(console.error("Table access error:",a),s("manual"),x.default.error("Table access error: "+a.message))}catch(e){console.error("Migration test error:",e),s("manual"),x.default.error("Connection test failed: "+e.message)}finally{u(!1)}};return(0,t.jsx)(n.Z,{children:(0,t.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,t.jsx)("div",{className:"bg-white shadow",children:(0,t.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)("button",{onClick:()=>h.push("/admin"),className:"mr-4 p-2 text-gray-400 hover:text-gray-600",children:(0,t.jsx)(c.Z,{className:"h-5 w-5"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-2xl font-bold leading-7 text-gray-900",children:"Setup Allowed Users Table"}),(0,t.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:"Create the database table for managing selective user registration"})]})]})})}),(0,t.jsx)("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:(0,t.jsx)("div",{className:"bg-white shadow rounded-lg",children:(0,t.jsx)("div",{className:"px-6 py-8",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)(d.Z,{className:"mx-auto h-12 w-12 text-blue-600 mb-4"}),(0,t.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Database Migration Required"}),(0,t.jsx)("p",{className:"text-sm text-gray-500 mb-6",children:"The allowed users feature requires a new database table. Click the button below to create it."}),"success"===e&&(0,t.jsx)("div",{className:"mb-6 p-4 bg-green-50 border border-green-200 rounded-md",children:(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)(o.Z,{className:"h-5 w-5 text-green-600 mr-2"}),(0,t.jsx)("p",{className:"text-sm text-green-800",children:"Migration completed successfully! You can now manage allowed users."})]})}),"error"===e&&(0,t.jsx)("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-md",children:(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)(m.Z,{className:"h-5 w-5 text-red-600 mr-2"}),(0,t.jsx)("p",{className:"text-sm text-red-800",children:"Migration failed. Please try running the SQL manually in Supabase."})]})}),"manual"===e&&(0,t.jsxs)("div",{className:"mb-6 p-4 bg-yellow-50 border border-yellow-200 rounded-md",children:[(0,t.jsxs)("div",{className:"flex items-center mb-2",children:[(0,t.jsx)(m.Z,{className:"h-5 w-5 text-yellow-600 mr-2"}),(0,t.jsx)("p",{className:"text-sm text-yellow-800 font-medium",children:"Manual Setup Required"})]}),(0,t.jsxs)("div",{className:"text-sm text-yellow-800",children:[(0,t.jsx)("p",{className:"mb-2",children:"Please follow these steps:"}),(0,t.jsxs)("ol",{className:"list-decimal list-inside space-y-1",children:[(0,t.jsx)("li",{children:"Go to your Supabase dashboard"}),(0,t.jsx)("li",{children:"Navigate to SQL Editor"}),(0,t.jsxs)("li",{children:["Copy the SQL from ",(0,t.jsx)("code",{children:"allowed-users-migration.sql"})]}),(0,t.jsx)("li",{children:"Paste and run it in the SQL Editor"}),(0,t.jsx)("li",{children:'Come back and click "Test Connection" below'})]})]})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)("button",{onClick:b,disabled:a||"success"===e,className:"inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-md text-white bg-church-primary hover:bg-church-secondary disabled:opacity-50 disabled:cursor-not-allowed",children:a?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"loading-spinner w-5 h-5 mr-2"}),"Checking..."]}):"success"===e?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(o.Z,{className:"h-5 w-5 mr-2"}),"Table Ready"]}):"manual"===e?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(d.Z,{className:"h-5 w-5 mr-2"}),"Test Connection"]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(d.Z,{className:"h-5 w-5 mr-2"}),"Check Table Status"]})}),"success"===e&&(0,t.jsx)("div",{className:"mt-4",children:(0,t.jsx)("button",{onClick:()=>h.push("/admin/allowed-users"),className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-church-primary bg-church-primary bg-opacity-10 hover:bg-opacity-20",children:"Go to Allowed Users Management"})})]}),(0,t.jsxs)("div",{className:"mt-8 text-left",children:[(0,t.jsx)("h4",{className:"text-sm font-medium text-gray-900 mb-2",children:"What this migration does:"}),(0,t.jsxs)("ul",{className:"text-sm text-gray-500 space-y-1",children:[(0,t.jsx)("li",{children:"• Creates the allowed_users table"}),(0,t.jsx)("li",{children:"• Sets up Row Level Security policies"}),(0,t.jsx)("li",{children:"• Creates necessary indexes for performance"}),(0,t.jsx)("li",{children:"• Configures admin-only access permissions"})]})]})]})})})})]})})}}},function(e){e.O(0,[5285,4733,2888,9774,179],function(){return e(e.s=2555)}),_N_E=e.O()}]);