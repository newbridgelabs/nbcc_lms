(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5576],{2837:function(e,s,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/fix-user-status",function(){return t(9295)}])},493:function(e,s,t){"use strict";t.d(s,{Z:function(){return r}});let r=(0,t(3759).Z)("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},4976:function(e,s,t){"use strict";t.d(s,{Z:function(){return r}});let r=(0,t(3759).Z)("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]])},8267:function(e,s,t){"use strict";t.d(s,{Z:function(){return r}});let r=(0,t(3759).Z)("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]])},9475:function(e,s,t){"use strict";t.d(s,{Z:function(){return r}});let r=(0,t(3759).Z)("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]])},9295:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return x}});var r=t(5893),l=t(7294),a=t(4733),i=t(1046),d=t(8267),c=t(4976),n=t(9200),o=t(9475),u=t(493),m=t(6501);function x(){let[e,s]=(0,l.useState)(!0),[t,x]=(0,l.useState)([]),[h,f]=(0,l.useState)(!1);(0,l.useEffect)(()=>{g()},[]);let g=async()=>{try{let{data:e,error:s}=await i.OQ.from("allowed_users").select("*").or("email.ilike.%alen%,full_name.ilike.%alen%").order("created_at",{ascending:!1});if(s)throw s;x(e||[]),console.log("Found Alen users:",e)}catch(e){console.error("Error loading users:",e),m.default.error("Failed to load users")}finally{s(!1)}},y=async(e,s)=>{f(!0);try{console.log("Resetting user status for:",e,s);let{data:t,error:r}=await i.OQ.from("allowed_users").update({is_used:!1,registered_at:null}).eq("id",e).select();if(r)throw r;console.log("Reset user:",t),m.default.success("✅ User status reset! ".concat(s," can now register.")),await g()}catch(e){console.error("Reset error:",e),m.default.error("Failed to reset user: "+e.message)}finally{f(!1)}},b=async(e,s)=>{if(confirm("Are you sure you want to delete ".concat(s,"?"))){f(!0);try{let{error:t}=await i.OQ.from("allowed_users").delete().eq("id",e);if(t)throw t;m.default.success("User ".concat(s," deleted successfully")),await g()}catch(e){console.error("Delete error:",e),m.default.error("Failed to delete user: "+e.message)}finally{f(!1)}}},j=async e=>{try{console.log("Testing registration for:",e);let{data:s,error:t}=await i.OQ.from("allowed_users").select("*").eq("email",e.toLowerCase()).eq("is_used",!1).single();console.log("Registration test result:",{allowedUser:s,allowedError:t}),t||!s?m.default.error("❌ Registration would fail: ".concat((null==t?void 0:t.message)||"User not found or already used")):m.default.success("✅ Registration would succeed for ".concat(e,"!"))}catch(e){console.error("Test error:",e),m.default.error("Test failed: "+e.message)}},p=async()=>{f(!0);try{let{data:e,error:s}=await i.OQ.from("allowed_users").insert({email:"alenps76@gmail.com",full_name:"Alen Pradeep",is_used:!1}).select();if(s){if("23505"===s.code)m.default.error("User already exists - use reset instead");else throw s}else m.default.success("User added successfully!"),await g()}catch(e){console.error("Add error:",e),m.default.error("Failed to add user: "+e.message)}finally{f(!1)}};return e?(0,r.jsx)(a.Z,{children:(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,r.jsx)("div",{className:"loading-spinner"})})}):(0,r.jsx)(a.Z,{requireAuth:!0,children:(0,r.jsx)("div",{className:"min-h-screen bg-gray-50",children:(0,r.jsx)("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:(0,r.jsxs)("div",{className:"bg-white shadow rounded-lg",children:[(0,r.jsx)("div",{className:"px-6 py-4 border-b border-gray-200",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)(d.Z,{className:"h-6 w-6 text-blue-600 mr-3"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-xl font-semibold text-gray-900",children:"Fix Alen's User Status"}),(0,r.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:"Reset user status to allow registration"})]})]}),(0,r.jsx)("button",{onClick:g,className:"p-2 text-gray-400 hover:text-gray-600",children:(0,r.jsx)(c.Z,{className:"h-5 w-5"})})]})}),(0,r.jsxs)("div",{className:"p-6",children:[(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsxs)("h2",{className:"text-lg font-medium text-gray-900 mb-4",children:["Found Users (",t.length,")"]}),0===t.length?(0,r.jsxs)("div",{className:"text-center py-8",children:[(0,r.jsx)(n.Z,{className:"mx-auto h-12 w-12 text-yellow-400"}),(0,r.jsx)("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No Alen users found"}),(0,r.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:"The user might not exist in the allowed_users table"}),(0,r.jsx)("button",{onClick:p,disabled:h,className:"mt-4 bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 disabled:opacity-50",children:"Add Correct User"})]}):(0,r.jsx)("div",{className:"space-y-4",children:t.map(e=>(0,r.jsx)("div",{className:"p-4 rounded-lg border ".concat(e.is_used?"bg-red-50 border-red-200":"bg-green-50 border-green-200"),children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsxs)("div",{className:"flex items-center mb-2",children:[(0,r.jsx)("h3",{className:"font-medium text-gray-900",children:e.full_name}),(0,r.jsx)("div",{className:"ml-2",children:e.is_used?(0,r.jsx)(o.Z,{className:"h-5 w-5 text-red-500",title:"Already used"}):(0,r.jsx)(u.Z,{className:"h-5 w-5 text-green-500",title:"Available"})})]}),(0,r.jsxs)("p",{className:"text-sm text-gray-600 mb-1",children:[(0,r.jsx)("strong",{children:"Email:"})," ",e.email]}),(0,r.jsxs)("p",{className:"text-sm text-gray-600 mb-1",children:[(0,r.jsx)("strong",{children:"Status:"})," ",e.is_used?"Already Used":"Available"]}),(0,r.jsxs)("p",{className:"text-xs text-gray-400",children:["Created: ",new Date(e.created_at).toLocaleString(),e.registered_at&&(0,r.jsxs)("span",{className:"ml-2",children:["| Registered: ",new Date(e.registered_at).toLocaleString()]})]})]}),(0,r.jsxs)("div",{className:"flex flex-col space-y-2 ml-4",children:[(0,r.jsx)("button",{onClick:()=>j(e.email),className:"bg-blue-600 text-white px-3 py-1 rounded text-sm hover:bg-blue-700",children:"Test Registration"}),e.is_used&&(0,r.jsx)("button",{onClick:()=>y(e.id,e.email),disabled:h,className:"bg-green-600 text-white px-3 py-1 rounded text-sm hover:bg-green-700 disabled:opacity-50",children:"Reset Status"}),(0,r.jsx)("button",{onClick:()=>b(e.id,e.email),disabled:h,className:"bg-red-600 text-white px-3 py-1 rounded text-sm hover:bg-red-700 disabled:opacity-50",children:"Delete"})]})]})},e.id))})]}),(0,r.jsxs)("div",{className:"border-t pt-6",children:[(0,r.jsx)("h2",{className:"text-lg font-medium text-gray-900 mb-4",children:"Instructions"}),(0,r.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[(0,r.jsx)("h3",{className:"font-medium text-blue-800 mb-2",children:"How to Fix:"}),(0,r.jsxs)("ol",{className:"list-decimal list-inside space-y-1 text-blue-700 text-sm",children:[(0,r.jsx)("li",{children:'If user shows "Already Used" (red), click "Reset Status"'}),(0,r.jsx)("li",{children:'Click "Test Registration" to verify the fix'}),(0,r.jsx)("li",{children:'If no users found, click "Add Correct User"'}),(0,r.jsx)("li",{children:"Ask Alen to try registering with alenps76@gmail.com"})]})]}),(0,r.jsxs)("div",{className:"mt-4 bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[(0,r.jsx)("h3",{className:"font-medium text-yellow-800 mb-2",children:"Common Issues:"}),(0,r.jsxs)("ul",{className:"list-disc list-inside space-y-1 text-yellow-700 text-sm",children:[(0,r.jsx)("li",{children:'User marked as "is_used = true" from previous registration attempt'}),(0,r.jsx)("li",{children:"Multiple duplicate entries in the database"}),(0,r.jsx)("li",{children:"Email case sensitivity issues"})]})]})]})]})]})})})})}}},function(e){e.O(0,[5285,4733,2888,9774,179],function(){return e(e.s=2837)}),_N_E=e.O()}]);