(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6310],{6382:function(e,s,l){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/registration-debug",function(){return l(2245)}])},9354:function(e,s,l){"use strict";l.d(s,{Z:function(){return r}});let r=(0,l(3759).Z)("Database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]])},6127:function(e,s,l){"use strict";l.d(s,{Z:function(){return r}});let r=(0,l(3759).Z)("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]])},8267:function(e,s,l){"use strict";l.d(s,{Z:function(){return r}});let r=(0,l(3759).Z)("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]])},2245:function(e,s,l){"use strict";l.r(s),l.d(s,{default:function(){return u}});var r=l(5893),a=l(7294),t=l(4733),i=l(1046),d=l(6127),n=l(9354),o=l(8267),c=l(9200),m=l(6501);function u(){var e,s,l,u,x,h,g,p;let[f,w]=(0,a.useState)(!1),[b,y]=(0,a.useState)(null),[N,j]=(0,a.useState)("alenps76@gmail.com"),v=async()=>{w(!0),y(null);let e={allAllowedUsers:[],emailSearchResults:[],registrationCheck:null,errors:[]};try{console.log("=== FULL REGISTRATION DEBUG ==="),console.log("Testing email:",N);let{data:s,error:l}=await i.OQ.from("allowed_users").select("*").order("created_at",{ascending:!1});l?e.errors.push("Failed to get all users: ".concat(l.message)):(e.allAllowedUsers=s||[],console.log("All allowed users:",s));let{data:r,error:a}=await i.OQ.from("allowed_users").select("*").or("email.ilike.%alen%,full_name.ilike.%alen%");a?e.errors.push("Failed to search for alen: ".concat(a.message)):(e.emailSearchResults=r||[],console.log("Alen search results:",r));let{data:t,error:d}=await i.OQ.from("allowed_users").select("*").eq("email",N.toLowerCase()).eq("is_used",!1).single();e.registrationCheck={email:N.toLowerCase(),allowedUser:t,error:(null==d?void 0:d.message)||null,success:!d&&t},console.log("Registration check result:",e.registrationCheck);let{data:n,error:o}=await i.OQ.from("allowed_users").select("*").eq("email",N.toLowerCase()).single();e.registrationCheck.anyUser=n,e.registrationCheck.anyError=(null==o?void 0:o.message)||null,y(e)}catch(s){console.error("Debug error:",s),e.errors.push("Debug error: ".concat(s.message)),y(e)}finally{w(!1)}},k=async()=>{try{console.log("=== DIRECT EMAIL FIX ===");let{data:e,error:s}=await i.OQ.from("allowed_users").select("*").ilike("email","%alenpr%");if(s)throw s;if(e&&e.length>0){let s=e[0];console.log("Found user to fix:",s);let{data:l,error:r}=await i.OQ.from("allowed_users").update({email:"alenps76@gmail.com"}).eq("id",s.id).select();if(r)throw r;console.log("Updated user:",l),m.default.success("Email fixed successfully!"),await v()}else m.default.error("No user found with alenpr email")}catch(e){console.error("Fix error:",e),m.default.error("Fix failed: "+e.message)}},C=async()=>{try{console.log("=== ADDING TEST USER ===");let{data:e,error:s}=await i.OQ.from("allowed_users").insert({email:"alenps76@gmail.com",full_name:"Alen Pradeep",is_used:!1}).select();if(s){if("23505"===s.code)m.default.error("User with this email already exists");else throw s}else console.log("Added user:",e),m.default.success("Test user added successfully!"),await v()}catch(e){console.error("Add user error:",e),m.default.error("Failed to add user: "+e.message)}};return(0,r.jsx)(t.Z,{requireAuth:!0,children:(0,r.jsx)("div",{className:"min-h-screen bg-gray-50",children:(0,r.jsx)("div",{className:"max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:(0,r.jsxs)("div",{className:"bg-white shadow rounded-lg",children:[(0,r.jsxs)("div",{className:"px-6 py-4 border-b border-gray-200",children:[(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)(d.Z,{className:"h-6 w-6 text-blue-600 mr-3"}),(0,r.jsx)("h1",{className:"text-xl font-semibold text-gray-900",children:"Registration Debug Tool"})]}),(0,r.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:"Deep dive into the registration issue"})]}),(0,r.jsxs)("div",{className:"p-6",children:[(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Test Email Address"}),(0,r.jsx)("input",{type:"email",value:N,onChange:e=>j(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,r.jsxs)("div",{className:"mb-6 flex flex-wrap gap-4",children:[(0,r.jsx)("button",{onClick:v,disabled:f,className:"bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 disabled:opacity-50 flex items-center",children:f?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"loading-spinner w-4 h-4 mr-2"}),"Debugging..."]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(d.Z,{className:"h-4 w-4 mr-2"}),"Run Full Debug"]})}),(0,r.jsxs)("button",{onClick:k,className:"bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 flex items-center",children:[(0,r.jsx)(n.Z,{className:"h-4 w-4 mr-2"}),"Fix Email Directly"]}),(0,r.jsxs)("button",{onClick:C,className:"bg-purple-600 text-white px-6 py-3 rounded-lg hover:bg-purple-700 flex items-center",children:[(0,r.jsx)(o.Z,{className:"h-4 w-4 mr-2"}),"Add Test User"]})]}),b&&(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:[(0,r.jsxs)("h3",{className:"text-lg font-medium text-gray-900 mb-3 flex items-center",children:[(0,r.jsx)(c.Z,{className:"h-5 w-5 mr-2"}),"Registration Check Result"]}),(0,r.jsxs)("div",{className:"p-3 rounded-lg ".concat((null===(e=b.registrationCheck)||void 0===e?void 0:e.success)?"bg-green-50 border border-green-200":"bg-red-50 border border-red-200"),children:[(0,r.jsxs)("p",{className:"font-medium",children:["Email: ",null===(s=b.registrationCheck)||void 0===s?void 0:s.email]}),(0,r.jsxs)("p",{className:"text-sm ".concat((null===(l=b.registrationCheck)||void 0===l?void 0:l.success)?"text-green-700":"text-red-700"),children:["Status: ",(null===(u=b.registrationCheck)||void 0===u?void 0:u.success)?"✅ WOULD SUCCEED":"❌ WOULD FAIL"]}),(null===(x=b.registrationCheck)||void 0===x?void 0:x.error)&&(0,r.jsxs)("p",{className:"text-sm text-red-600 mt-1",children:["Error: ",b.registrationCheck.error]}),(null===(h=b.registrationCheck)||void 0===h?void 0:h.allowedUser)&&(0,r.jsxs)("div",{className:"mt-2",children:[(0,r.jsx)("p",{className:"text-sm font-medium",children:"Found User:"}),(0,r.jsx)("pre",{className:"text-xs bg-white p-2 rounded mt-1",children:JSON.stringify(b.registrationCheck.allowedUser,null,2)})]}),(null===(g=b.registrationCheck)||void 0===g?void 0:g.anyUser)&&!(null===(p=b.registrationCheck)||void 0===p?void 0:p.allowedUser)&&(0,r.jsxs)("div",{className:"mt-2",children:[(0,r.jsx)("p",{className:"text-sm font-medium text-yellow-700",children:"User exists but is_used=true:"}),(0,r.jsx)("pre",{className:"text-xs bg-white p-2 rounded mt-1",children:JSON.stringify(b.registrationCheck.anyUser,null,2)})]})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("h3",{className:"text-lg font-medium text-gray-900 mb-3",children:["All Allowed Users (",b.allAllowedUsers.length,")"]}),(0,r.jsx)("div",{className:"max-h-64 overflow-y-auto space-y-2",children:b.allAllowedUsers.map(e=>(0,r.jsx)("div",{className:"p-3 rounded-lg border text-sm ".concat(e.email.includes("alen")?"bg-yellow-50 border-yellow-200":"bg-gray-50 border-gray-200"),children:(0,r.jsxs)("div",{className:"flex justify-between items-start",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"font-medium",children:e.full_name}),(0,r.jsx)("p",{className:"text-gray-600",children:e.email}),(0,r.jsxs)("p",{className:"text-xs text-gray-400",children:["Used: ",e.is_used?"Yes":"No"," | ID: ",e.id.substring(0,8),"..."]})]}),e.email.includes("alen")&&(0,r.jsx)(c.Z,{className:"h-4 w-4 text-yellow-500"})]})},e.id))})]}),b.emailSearchResults.length>0&&(0,r.jsxs)("div",{children:[(0,r.jsxs)("h3",{className:"text-lg font-medium text-gray-900 mb-3",children:["Alen Search Results (",b.emailSearchResults.length,")"]}),(0,r.jsx)("div",{className:"space-y-2",children:b.emailSearchResults.map(e=>(0,r.jsxs)("div",{className:"p-3 bg-yellow-50 border border-yellow-200 rounded-lg text-sm",children:[(0,r.jsx)("p",{className:"font-medium",children:e.full_name}),(0,r.jsx)("p",{className:"text-gray-600",children:e.email}),(0,r.jsxs)("p",{className:"text-xs text-gray-400",children:["Used: ",e.is_used?"Yes":"No"," | Created: ",new Date(e.created_at).toLocaleDateString()]})]},e.id))})]}),b.errors.length>0&&(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-lg font-medium text-red-900 mb-3",children:"Errors"}),(0,r.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:(0,r.jsx)("ul",{className:"list-disc list-inside space-y-1 text-sm text-red-700",children:b.errors.map((e,s)=>(0,r.jsx)("li",{children:e},s))})})]})]})]})]})})})})}}},function(e){e.O(0,[5285,4733,2888,9774,179],function(){return e(e.s=6382)}),_N_E=e.O()}]);