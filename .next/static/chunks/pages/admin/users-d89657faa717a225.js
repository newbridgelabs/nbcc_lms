(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9635],{2257:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/users",function(){return s(5736)}])},2761:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(3759).Z)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},5928:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(3759).Z)("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]])},6127:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(3759).Z)("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]])},3416:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(3759).Z)("Shield",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10",key:"1irkt0"}]])},7864:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(3759).Z)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]])},8267:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(3759).Z)("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]])},9176:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(3759).Z)("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]])},5736:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return f}});var a=s(5893),r=s(7294),l=s(1163),n=s(4733),i=s(1046),c=s(1164),d=s(3416),m=s(8267),o=s(2761),x=s(6127),u=s(9176),h=s(5928),g=s(7864),y=s(2190),p=s(6501);function f(){var e,t;let s;let[f,j]=(0,r.useState)(null),[w,N]=(0,r.useState)([]),[v,b]=(0,r.useState)(!0),[k,_]=(0,r.useState)(""),[Z,C]=(0,r.useState)("all"),[S,M]=(0,r.useState)(null),[A,E]=(0,r.useState)(null),U=(0,l.useRouter)();(0,r.useEffect)(()=>{L()},[]);let L=async()=>{let{isAdmin:e,user:t}=await (0,c.jW)(U,j,b);e&&t&&await D()},D=async()=>{try{let{data:e,error:t}=await i.OQ.from("users").select("\n          *,\n          agreements(id, status, created_at),\n          user_progress(id, completed)\n        ").order("created_at",{ascending:!1});if(t)throw t;N(e||[])}catch(e){console.error("Error loading users:",e),p.default.error("Failed to load users")}},O=async(e,t)=>{if(e===f.id){p.default.error("You cannot delete your own account");return}try{console.log("Deleting user:",e,t);try{let{error:e}=await i.OQ.from("allowed_users").update({is_used:!1,registered_at:null}).eq("email",t.toLowerCase());e?console.warn("Could not reset allowed_users entry:",e.message):console.log("Reset allowed_users entry for:",t)}catch(e){console.warn("Error resetting allowed_users:",e.message)}let{error:s}=await i.OQ.auth.admin.deleteUser(e);if(s){let{error:t}=await i.OQ.from("users").delete().eq("id",e);if(t)throw t}p.default.success("User ".concat(t," deleted successfully and can register again if needed")),await D(),M(null)}catch(e){console.error("Error deleting user:",e),p.default.error("Failed to delete user: "+e.message)}},q=e=>{var t;let s=e.agreements||[],a=e.user_progress||[];return{hasAgreement:s.length>0,agreementStatus:(null===(t=s[0])||void 0===t?void 0:t.status)||"none",completedSections:a.filter(e=>e.completed).length,totalProgress:a.length}},z=e=>!0===e.is_admin||"admin"===e.role?(0,a.jsxs)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-purple-100 text-purple-800",children:[(0,a.jsx)(d.Z,{className:"h-3 w-3 mr-1"}),"Admin"]}):(0,a.jsxs)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:[(0,a.jsx)(m.Z,{className:"h-3 w-3 mr-1"}),"Member"]});if(v)return(0,a.jsx)(n.Z,{children:(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,a.jsx)("div",{className:"loading-spinner"})})});let P=(s=w,"admin"===Z?s=s.filter(e=>!0===e.is_admin||"admin"===e.role):"member"===Z&&(s=s.filter(e=>!0!==e.is_admin&&"admin"!==e.role)),k&&(s=s.filter(e=>{var t,s,a;return(null===(t=e.full_name)||void 0===t?void 0:t.toLowerCase().includes(k.toLowerCase()))||(null===(s=e.email)||void 0===s?void 0:s.toLowerCase().includes(k.toLowerCase()))||(null===(a=e.username)||void 0===a?void 0:a.toLowerCase().includes(k.toLowerCase()))})),s);return(0,a.jsx)(n.Z,{children:(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,a.jsx)("div",{className:"bg-white shadow",children:(0,a.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("button",{onClick:()=>U.push("/admin"),className:"mr-4 p-2 text-gray-400 hover:text-gray-600",children:(0,a.jsx)(o.Z,{className:"h-5 w-5"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl font-bold leading-7 text-gray-900",children:"User Management"}),(0,a.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:"Manage church members and administrators"})]})]})})}),(0,a.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,a.jsx)("div",{className:"bg-white shadow rounded-lg p-6 mb-8",children:(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between space-y-4 sm:space-y-0",children:[(0,a.jsxs)("div",{className:"flex space-x-4",children:[(0,a.jsxs)("button",{onClick:()=>C("all"),className:"px-4 py-2 text-sm font-medium rounded-md ".concat("all"===Z?"bg-church-primary text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:["All Users (",w.length,")"]}),(0,a.jsxs)("button",{onClick:()=>C("admin"),className:"px-4 py-2 text-sm font-medium rounded-md ".concat("admin"===Z?"bg-church-primary text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:["Admins (",w.filter(e=>!0===e.is_admin||"admin"===e.role).length,")"]}),(0,a.jsxs)("button",{onClick:()=>C("member"),className:"px-4 py-2 text-sm font-medium rounded-md ".concat("member"===Z?"bg-church-primary text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:["Members (",w.filter(e=>!0!==e.is_admin&&"admin"!==e.role).length,")"]})]}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,a.jsx)(x.Z,{className:"h-5 w-5 text-gray-400"})}),(0,a.jsx)("input",{type:"text",placeholder:"Search users...",value:k,onChange:e=>_(e.target.value),className:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-1 focus:ring-church-primary focus:border-church-primary"})]})]})}),(0,a.jsx)("div",{className:"bg-white shadow rounded-lg overflow-hidden",children:0===P.length?(0,a.jsxs)("div",{className:"text-center py-12",children:[(0,a.jsx)(u.Z,{className:"mx-auto h-12 w-12 text-gray-400"}),(0,a.jsx)("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No users found"}),(0,a.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:"all"===Z?"No users have registered yet.":"No ".concat(Z,"s found.")})]}):(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"User"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Type"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Agreement"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Progress"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Joined"}),(0,a.jsx)("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,a.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:P.map(e=>{var t,s;let r=q(e);return(0,a.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"flex-shrink-0 h-10 w-10",children:(0,a.jsx)("div",{className:"h-10 w-10 rounded-full bg-church-primary flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-sm font-medium text-white",children:(null===(t=e.full_name)||void 0===t?void 0:t.charAt(0))||(null===(s=e.email)||void 0===s?void 0:s.charAt(0))||"U"})})}),(0,a.jsxs)("div",{className:"ml-4",children:[(0,a.jsx)("div",{className:"text-sm font-medium text-gray-900",children:e.full_name||"Unknown"}),(0,a.jsx)("div",{className:"text-sm text-gray-500",children:e.email})]})]})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:z(e)}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:r.hasAgreement?(0,a.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat("completed"===r.agreementStatus?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"),children:r.agreementStatus}):(0,a.jsx)("span",{className:"text-sm text-gray-500",children:"None"})}),(0,a.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:[r.completedSections," sections"]}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:new Date(e.created_at).toLocaleDateString()}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:(0,a.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,a.jsx)("button",{onClick:()=>E(e),className:"text-church-primary hover:text-church-secondary",title:"View user details",children:(0,a.jsx)(h.Z,{className:"h-4 w-4"})}),e.id!==f.id&&(0,a.jsx)("button",{onClick:()=>M(e),className:"text-red-600 hover:text-red-900",title:"Delete user",children:(0,a.jsx)(g.Z,{className:"h-4 w-4"})})]})})]},e.id)})})]})})})]}),A&&(0,a.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:(0,a.jsx)("div",{className:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white",children:(0,a.jsxs)("div",{className:"mt-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"User Details"}),(0,a.jsx)("button",{onClick:()=>E(null),className:"text-gray-400 hover:text-gray-600",children:(0,a.jsx)(y.Z,{className:"h-5 w-5"})})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm font-medium text-gray-500",children:"Name"}),(0,a.jsx)("p",{className:"text-sm text-gray-900",children:A.full_name||"Not provided"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm font-medium text-gray-500",children:"Email"}),(0,a.jsx)("p",{className:"text-sm text-gray-900",children:A.email})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm font-medium text-gray-500",children:"Role"}),(0,a.jsx)("p",{className:"text-sm text-gray-900",children:A.is_admin?"Administrator":"Member"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm font-medium text-gray-500",children:"Joined"}),(0,a.jsx)("p",{className:"text-sm text-gray-900",children:new Date(A.created_at).toLocaleDateString()})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm font-medium text-gray-500",children:"Agreements"}),(0,a.jsxs)("p",{className:"text-sm text-gray-900",children:[(null===(e=A.agreements)||void 0===e?void 0:e.length)||0," submitted"]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm font-medium text-gray-500",children:"Progress"}),(0,a.jsxs)("p",{className:"text-sm text-gray-900",children:[(null===(t=A.user_progress)||void 0===t?void 0:t.filter(e=>e.completed).length)||0," sections completed"]})]})]}),(0,a.jsx)("div",{className:"mt-6",children:(0,a.jsx)("button",{onClick:()=>E(null),className:"w-full px-4 py-2 bg-gray-300 text-gray-800 text-base font-medium rounded-md shadow-sm hover:bg-gray-400 focus:outline-none focus:ring-2 focus:ring-gray-300",children:"Close"})})]})})}),S&&(0,a.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:(0,a.jsx)("div",{className:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white",children:(0,a.jsxs)("div",{className:"mt-3 text-center",children:[(0,a.jsx)("div",{className:"mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100",children:(0,a.jsx)(g.Z,{className:"h-6 w-6 text-red-600"})}),(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mt-4",children:"Delete User"}),(0,a.jsx)("div",{className:"mt-2 px-7 py-3",children:(0,a.jsxs)("p",{className:"text-sm text-gray-500",children:["Are you sure you want to delete ",(0,a.jsx)("strong",{children:S.full_name||S.email}),"? This action cannot be undone and will remove all their data including agreements and progress."]})}),(0,a.jsx)("div",{className:"items-center px-4 py-3",children:(0,a.jsxs)("div",{className:"flex space-x-3",children:[(0,a.jsx)("button",{onClick:()=>M(null),className:"px-4 py-2 bg-gray-300 text-gray-800 text-base font-medium rounded-md shadow-sm hover:bg-gray-400 focus:outline-none focus:ring-2 focus:ring-gray-300",children:"Cancel"}),(0,a.jsx)("button",{onClick:()=>O(S.id,S.email),className:"px-4 py-2 bg-red-600 text-white text-base font-medium rounded-md shadow-sm hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500",children:"Delete"})]})})]})})})]})})}}},function(e){e.O(0,[5285,4733,2888,9774,179],function(){return e(e.s=2257)}),_N_E=e.O()}]);