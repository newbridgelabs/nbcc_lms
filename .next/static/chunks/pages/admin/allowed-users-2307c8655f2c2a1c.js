(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3985],{9100:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/allowed-users",function(){return a(6484)}])},9592:function(e,t,a){"use strict";a.d(t,{j$:function(){return r},u_:function(){return l},vE:function(){return n},zk:function(){return i}});var s=a(1046);let r=async(e,t)=>{try{console.log("Sending Supabase invitation email to:",e);let{data:a,error:r}=await s.OQ.auth.admin.inviteUserByEmail(e,{data:{full_name:t,invited_by:"NBCC Admin",invitation_type:"church_membership"},redirectTo:"".concat(window.location.origin,"/auth/callback?type=invite")});if(r)return console.error("Supabase invitation error:",r),{success:!1,error:r.message};return console.log("Supabase invitation sent successfully:",a),{success:!0,message:"Invitation email sent via Supabase",data:a}}catch(e){return console.error("Supabase email service error:",e),{success:!1,error:e.message}}},i=async e=>{try{console.log("Sending verification email to:",e);let{data:t,error:a}=await s.OQ.auth.resend({type:"signup",email:e,options:{emailRedirectTo:"".concat(window.location.origin,"/auth/callback")}});if(a)return console.error("Verification email error:",a),{success:!1,error:a.message};return console.log("Verification email sent successfully"),{success:!0,message:"Verification email sent",data:t}}catch(e){return console.error("Verification email service error:",e),{success:!1,error:e.message}}},n=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"notification";try{if(console.log("=== HYBRID EMAIL SERVICE ==="),console.log("Email type:",t),console.log("Recipient:",e.to_email),"invitation"===t){let t=await r(e.to_email,e.to_name);if(t.success)return t;console.warn("Supabase invitation failed, falling back to EmailJS:",t.error)}if("verification"===t){let t=await i(e.to_email);if(t.success)return t;console.warn("Supabase verification failed, falling back to EmailJS:",t.error)}console.log("Using EmailJS fallback...");let s=(await Promise.resolve().then(a.bind(a,9101))).default,n="service_6p2szkk",l="template_h0ekplo",o="vjXyYpLgDibpvaLPL";if(!n||!l||!o)throw Error("EmailJS configuration missing");s.init(o);let c=await s.send(n,l,e);if(200===c.status)return{success:!0,message:"Email sent via EmailJS",service:"emailjs",result:c};throw Error("EmailJS failed with status: ".concat(c.status))}catch(e){return console.error("Hybrid email service error:",e),{success:!1,error:e.message}}},l=async e=>{let t={supabase:{available:!1,error:null},emailjs:{available:!1,error:null}};try{if(s.OQ){let{data:{user:e},error:a}=await s.OQ.auth.getUser();a?t.supabase.error=a.message:t.supabase.available=!0}}catch(e){t.supabase.error=e.message}try{t.emailjs.available=!0}catch(e){t.emailjs.error=e.message}return t}},2761:function(e,t,a){"use strict";a.d(t,{Z:function(){return s}});let s=(0,a(3759).Z)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},6815:function(e,t,a){"use strict";a.d(t,{Z:function(){return s}});let s=(0,a(3759).Z)("PenSquare",[["path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1qinfi"}],["path",{d:"M18.5 2.5a2.12 2.12 0 0 1 3 3L12 15l-4 1 1-4Z",key:"w2jsv5"}]])},4270:function(e,t,a){"use strict";a.d(t,{Z:function(){return s}});let s=(0,a(3759).Z)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},3603:function(e,t,a){"use strict";a.d(t,{Z:function(){return s}});let s=(0,a(3759).Z)("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]])},7864:function(e,t,a){"use strict";a.d(t,{Z:function(){return s}});let s=(0,a(3759).Z)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]])},2220:function(e,t,a){"use strict";a.d(t,{Z:function(){return s}});let s=(0,a(3759).Z)("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]])},9176:function(e,t,a){"use strict";a.d(t,{Z:function(){return s}});let s=(0,a(3759).Z)("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]])},6484:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return p}});var s=a(5893),r=a(7294),i=a(1163),n=a(4733),l=a(1046),o=a(1164),c=a(9592),d=a(2761),u=a(4270),m=a(9176),h=a(2220),f=a(6815),x=a(3603),y=a(7864),g=a(6501);function p(){let[e,t]=(0,r.useState)(null),[a,p]=(0,r.useState)([]),[v,w]=(0,r.useState)(!0),[b,N]=(0,r.useState)(!1),[j,k]=(0,r.useState)({email:"",fullName:""}),[_,E]=(0,r.useState)(!1),S=(0,i.useRouter)();(0,r.useEffect)(()=>{C()},[]);let C=async()=>{let{isAdmin:e,user:a}=await (0,o.jW)(S,t,w);e&&a&&await Z()},Z=async()=>{try{let{data:e,error:t}=await l.OQ.from("allowed_users").select("*").order("created_at",{ascending:!1});if(t)throw t;p(e||[])}catch(e){console.error("Error loading allowed users:",e),g.default.error("Failed to load allowed users")}},M=async t=>{if(t.preventDefault(),!j.email||!j.fullName){g.default.error("Please fill in all fields");return}E(!0);try{let{data:t,error:a}=await l.OQ.from("allowed_users").insert({email:j.email.toLowerCase(),full_name:j.fullName,invited_by:e.id,invitation_sent_at:new Date().toISOString()}).select().single();if(a){if("23505"===a.code)throw Error("This email is already in the allowed users list");throw a}let s=await (0,c.vE)({to_email:j.email,to_name:j.fullName,subject:"Welcome to New Bridge Community Church - Complete Your Registration",message:"Dear ".concat(j.fullName,",\n\nYou have been invited to join the New Bridge Community Church family!\n\nTo complete your membership registration, please visit our website and create your account using this email address.\n\nRegistration Link: ").concat(window.location.origin,"/auth/register\n\nWe look forward to welcoming you to our church community.\n\nBlessings,\nNBCC Admin Team")},"invitation");s.success?g.default.success("User added and invitation email sent successfully!"):(g.default.success("User added successfully, but email sending failed. Please share credentials manually."),console.warn("Email sending failed:",s.error)),k({email:"",fullName:""}),N(!1),await Z()}catch(e){console.error("Error adding user:",e),g.default.error(e.message||"Failed to add user")}finally{E(!1)}},A=async(e,t)=>{if(confirm("Are you sure you want to remove ".concat(t," from the allowed users list?")))try{let{error:t}=await l.OQ.from("allowed_users").delete().eq("id",e);if(t)throw t;g.default.success("User removed successfully"),await Z()}catch(e){console.error("Error deleting user:",e),g.default.error("Failed to remove user")}},U=async(e,t,a)=>{let s=prompt("Enter correct email address:",t);if(!s||s===t)return;let r=prompt("Enter correct full name:",a);if(r&&r!==a)try{let{error:t}=await l.OQ.from("allowed_users").update({email:s.toLowerCase(),full_name:r}).eq("id",e);if(t)throw t;g.default.success("User information updated successfully"),await Z()}catch(e){console.error("Error updating user:",e),g.default.error("Failed to update user information")}},O=async e=>{E(!0);try{let t=await (0,c.vE)({to_email:e.email,to_name:e.full_name,subject:"Welcome to New Bridge Community Church - Complete Your Registration",message:"Dear ".concat(e.full_name,",\n\nYou have been invited to join the New Bridge Community Church family!\n\nTo complete your membership registration, please visit our website and create your account using this email address.\n\nRegistration Link: ").concat(window.location.origin,"/auth/register\n\nWe look forward to welcoming you to our church community.\n\nBlessings,\nNBCC Admin Team")},"invitation");t.success?(await l.OQ.from("allowed_users").update({invitation_sent_at:new Date().toISOString()}).eq("id",e.id),g.default.success("Invitation email resent successfully!"),await Z()):g.default.error("Failed to send invitation email: "+t.error)}catch(e){console.error("Error resending invitation:",e),g.default.error("Failed to resend invitation")}finally{E(!1)}};return v?(0,s.jsx)(n.Z,{children:(0,s.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,s.jsx)("div",{className:"loading-spinner"})})}):(0,s.jsx)(n.Z,{children:(0,s.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,s.jsx)("div",{className:"bg-white shadow",children:(0,s.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("button",{onClick:()=>S.push("/admin"),className:"mr-4 p-2 text-gray-400 hover:text-gray-600",children:(0,s.jsx)(d.Z,{className:"h-5 w-5"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-2xl font-bold leading-7 text-gray-900",children:"Allowed Users Management"}),(0,s.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:"Manage who can register for church membership"})]})]}),(0,s.jsxs)("button",{onClick:()=>N(!0),className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-church-primary hover:bg-church-secondary",children:[(0,s.jsx)(u.Z,{className:"h-4 w-4 mr-2"}),"Add User"]})]})})}),(0,s.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[b&&(0,s.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:(0,s.jsx)("div",{className:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white",children:(0,s.jsxs)("div",{className:"mt-3",children:[(0,s.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Add New Allowed User"}),(0,s.jsxs)("form",{onSubmit:M,children:[(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Full Name"}),(0,s.jsx)("input",{type:"text",value:j.fullName,onChange:e=>k(t=>({...t,fullName:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-church-primary",required:!0})]}),(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email Address"}),(0,s.jsx)("input",{type:"email",value:j.email,onChange:e=>k(t=>({...t,email:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-church-primary",required:!0})]}),(0,s.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,s.jsx)("button",{type:"button",onClick:()=>{N(!1),k({email:"",fullName:""})},className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md",children:"Cancel"}),(0,s.jsx)("button",{type:"submit",disabled:_,className:"px-4 py-2 text-sm font-medium text-white bg-church-primary hover:bg-church-secondary rounded-md disabled:opacity-50",children:_?"Adding...":"Add & Send Invitation"})]})]})]})})}),(0,s.jsxs)("div",{className:"bg-white shadow overflow-hidden sm:rounded-md",children:[(0,s.jsxs)("div",{className:"px-4 py-5 sm:px-6",children:[(0,s.jsxs)("h3",{className:"text-lg leading-6 font-medium text-gray-900",children:["Allowed Users (",a.length,")"]}),(0,s.jsx)("p",{className:"mt-1 max-w-2xl text-sm text-gray-500",children:"Users who are allowed to register for church membership"})]}),0===a.length?(0,s.jsxs)("div",{className:"text-center py-12",children:[(0,s.jsx)(m.Z,{className:"mx-auto h-12 w-12 text-gray-400"}),(0,s.jsx)("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No allowed users"}),(0,s.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:"Get started by adding the first allowed user."})]}):(0,s.jsx)("ul",{className:"divide-y divide-gray-200",children:a.map(e=>(0,s.jsx)("li",{className:"px-4 py-4 sm:px-6",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("div",{className:"flex-shrink-0",children:(0,s.jsx)("div",{className:"h-10 w-10 rounded-full bg-gray-300 flex items-center justify-center",children:(0,s.jsx)(h.Z,{className:"h-5 w-5 text-gray-600"})})}),(0,s.jsxs)("div",{className:"ml-4",children:[(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("p",{className:"text-sm font-medium text-gray-900",children:e.full_name}),e.is_used&&(0,s.jsx)("span",{className:"ml-2 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800",children:"Registered"})]}),(0,s.jsx)("p",{className:"text-sm text-gray-500",children:e.email}),(0,s.jsxs)("p",{className:"text-xs text-gray-400",children:["Added: ",new Date(e.created_at).toLocaleDateString(),e.invitation_sent_at&&(0,s.jsxs)("span",{className:"ml-2",children:["â€¢ Invited: ",new Date(e.invitation_sent_at).toLocaleDateString()]})]})]})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)("button",{onClick:()=>U(e.id,e.email,e.full_name),className:"text-blue-600 hover:text-blue-900",title:"Edit user information",children:(0,s.jsx)(f.Z,{className:"h-4 w-4"})}),!e.is_used&&(0,s.jsx)("button",{onClick:()=>O(e),disabled:_,className:"text-church-primary hover:text-church-secondary disabled:opacity-50",title:"Resend invitation",children:(0,s.jsx)(x.Z,{className:"h-4 w-4"})}),(0,s.jsx)("button",{onClick:()=>A(e.id,e.email),className:"text-red-600 hover:text-red-900",title:"Remove user",children:(0,s.jsx)(y.Z,{className:"h-4 w-4"})})]})]})},e.id))})]})]})]})})}}},function(e){e.O(0,[5285,4733,2888,9774,179],function(){return e(e.s=9100)}),_N_E=e.O()}]);