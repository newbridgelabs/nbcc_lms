(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3680],{3962:function(e,s,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/email-verification-fix",function(){return a(7789)}])},493:function(e,s,a){"use strict";a.d(s,{Z:function(){return t}});let t=(0,a(3759).Z)("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},6691:function(e,s,a){"use strict";a.d(s,{Z:function(){return t}});let t=(0,a(3759).Z)("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]])},9475:function(e,s,a){"use strict";a.d(s,{Z:function(){return t}});let t=(0,a(3759).Z)("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]])},7789:function(e,s,a){"use strict";a.r(s),a.d(s,{default:function(){return m}});var t=a(5893),i=a(7294),l=a(4733),r=a(1046),n=a(6691),c=a(493),d=a(9475),o=a(6501),u=a(3454);function m(){let[e,s]=(0,i.useState)(!1),[a,m]=(0,i.useState)("alenps76@gmail.com"),[g,p]=(0,i.useState)([]),[x,f]=(0,i.useState)(null);(0,i.useEffect)(()=>{y()},[]);let h=e=>{p(s=>[...s,{...e,timestamp:new Date().toLocaleTimeString()}])},y=async()=>{try{let e={url:"https://qyhdzjzvkggcsuhnenaz.supabase.co",anonKey:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InF5aGR6anp2a2dnY3N1aG5lbmF6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk0NjY1NzgsImV4cCI6MjA2NTA0MjU3OH0.wauN1JdrKCl82WFuwtCfq0oZVob8UEE71wjJw6otCFY",serviceRoleKey:u.env.SUPABASE_SERVICE_ROLE_KEY?"Set":"Not Set",supabaseConnected:!!r.OQ};f(e)}catch(e){console.error("Config check error:",e)}},b=async()=>{s(!0),p([]);try{h({type:"Info",success:!0,message:"Starting email verification test for ".concat(a),details:{email:a}}),h({type:"Step 1",success:!0,message:"Checking allowed_users table...",details:{}});let{data:e,error:s}=await r.OQ.from("allowed_users").select("*").eq("email",a.toLowerCase()).single();if(s||!e){h({type:"Step 1",success:!1,message:"User not found in allowed_users table",details:{error:null==s?void 0:s.message}}),h({type:"Fix",success:!0,message:"Adding user to allowed_users table...",details:{}});let{data:e,error:t}=await r.OQ.from("allowed_users").insert({email:a.toLowerCase(),full_name:"Alen PS",invited_by:"admin",invitation_sent_at:new Date().toISOString(),is_used:!1}).select().single();t?h({type:"Fix",success:!1,message:"Failed to add user to allowed_users",details:{error:t.message}}):h({type:"Fix",success:!0,message:"User added to allowed_users successfully",details:e})}else h({type:"Step 1",success:!0,message:"User found in allowed_users table",details:e});h({type:"Step 2",success:!0,message:"Testing email verification sending...",details:{}});let{error:t}=await r.OQ.auth.resend({type:"signup",email:a,options:{emailRedirectTo:"".concat(window.location.origin,"/auth/callback")}});t?(h({type:"Step 2",success:!1,message:"Failed to send verification email via Supabase",details:{error:t.message}}),h({type:"Alternative",success:!0,message:"Supabase email not configured. User can register without email verification.",details:{suggestion:"Configure Supabase SMTP settings or use manual verification",workaround:"User can complete registration and admin can manually verify"}})):h({type:"Step 2",success:!0,message:"Verification email sent successfully via Supabase",details:{email:a}}),h({type:"Step 3",success:!0,message:"Testing registration process...",details:{}});let{data:i,error:l}=await r.OQ.rpc("check_allowed_user",{user_email:a.toLowerCase()});l?h({type:"Step 3",success:!1,message:"Registration check failed",details:{error:l.message}}):i&&i.length>0?h({type:"Step 3",success:!0,message:"User can register successfully",details:i[0]}):h({type:"Step 3",success:!1,message:"User cannot register - not in allowed list",details:{}})}catch(e){h({type:"Error",success:!1,message:"Test failed with error",details:{error:e.message}})}finally{s(!1)}},w=async()=>{try{let{error:e}=await r.OQ.from("allowed_users").update({is_used:!1,manual_verification:!0,verified_at:new Date().toISOString()}).eq("email",a.toLowerCase());e?o.default.error("Failed to manually verify user: "+e.message):(o.default.success("User manually verified! They can now register without email verification."),h({type:"Manual Fix",success:!0,message:"User manually verified - can register without email confirmation",details:{email:a}}))}catch(e){o.default.error("Manual verification failed: "+e.message)}};return(0,t.jsx)(l.Z,{children:(0,t.jsx)("div",{className:"min-h-screen bg-gray-50 py-8",children:(0,t.jsxs)("div",{className:"max-w-4xl mx-auto px-4",children:[(0,t.jsxs)("div",{className:"bg-white rounded-lg shadow p-6 mb-6",children:[(0,t.jsxs)("h1",{className:"text-2xl font-bold mb-6 flex items-center",children:[(0,t.jsx)(n.Z,{className:"h-6 w-6 mr-2 text-blue-600"}),"Email Verification Fix Tool"]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[(0,t.jsxs)("div",{className:"bg-gray-50 p-4 rounded-md",children:[(0,t.jsx)("h3",{className:"font-medium text-gray-900 mb-2",children:"Supabase Configuration"}),x&&(0,t.jsxs)("div",{className:"text-sm space-y-1",children:[(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{children:"URL:"}),(0,t.jsx)("span",{className:x.url?"text-green-600":"text-red-600",children:x.url?"Set":"Not Set"})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{children:"Anon Key:"}),(0,t.jsx)("span",{className:x.anonKey?"text-green-600":"text-red-600",children:x.anonKey?"Set":"Not Set"})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{children:"Connected:"}),(0,t.jsx)("span",{className:x.supabaseConnected?"text-green-600":"text-red-600",children:x.supabaseConnected?"Yes":"No"})]})]})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Test Email Address"}),(0,t.jsx)("input",{type:"email",value:a,onChange:e=>m(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter email to test"})]}),(0,t.jsxs)("div",{className:"flex space-x-2",children:[(0,t.jsx)("button",{onClick:b,disabled:e||!a,className:"flex-1 bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:e?"Testing...":"Test Email Verification"}),(0,t.jsx)("button",{onClick:w,disabled:!a,className:"bg-green-600 text-white py-2 px-4 rounded-md hover:bg-green-700 disabled:opacity-50",children:"Manual Verify"})]})]})]})]}),g.length>0&&(0,t.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,t.jsx)("h2",{className:"text-lg font-semibold mb-4",children:"Test Results"}),(0,t.jsx)("div",{className:"space-y-3",children:g.map((e,s)=>(0,t.jsx)("div",{className:"p-3 rounded-md border-l-4 ".concat(e.success?"border-green-400 bg-green-50":"border-red-400 bg-red-50"),children:(0,t.jsxs)("div",{className:"flex items-start",children:[e.success?(0,t.jsx)(c.Z,{className:"h-5 w-5 text-green-500 mr-2 mt-0.5"}):(0,t.jsx)(d.Z,{className:"h-5 w-5 text-red-500 mr-2 mt-0.5"}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsxs)("div",{className:"flex justify-between items-start",children:[(0,t.jsxs)("span",{className:"font-medium text-gray-900",children:["[",e.type,"] ",e.message]}),(0,t.jsx)("span",{className:"text-xs text-gray-500",children:e.timestamp})]}),e.details&&Object.keys(e.details).length>0&&(0,t.jsx)("pre",{className:"mt-2 text-xs text-gray-600 bg-white p-2 rounded border overflow-x-auto",children:JSON.stringify(e.details,null,2)})]})]})},s))})]})]})})})}}},function(e){e.O(0,[5285,4733,2888,9774,179],function(){return e(e.s=3962)}),_N_E=e.O()}]);