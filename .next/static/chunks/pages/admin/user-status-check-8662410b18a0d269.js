(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[498],{8476:function(e,s,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/user-status-check",function(){return t(1204)}])},3765:function(e,s,t){"use strict";t.d(s,{Z:function(){return a}});let a=(0,t(3759).Z)("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},493:function(e,s,t){"use strict";t.d(s,{Z:function(){return a}});let a=(0,t(3759).Z)("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},6691:function(e,s,t){"use strict";t.d(s,{Z:function(){return a}});let a=(0,t(3759).Z)("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]])},6127:function(e,s,t){"use strict";t.d(s,{Z:function(){return a}});let a=(0,t(3759).Z)("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]])},9475:function(e,s,t){"use strict";t.d(s,{Z:function(){return a}});let a=(0,t(3759).Z)("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]])},1204:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return g}});var a=t(5893),r=t(7294),i=t(1163),n=t(4733),l=t(1046),o=t(1164),c=t(493),d=t(9475),u=t(3765),m=t(6691),h=t(6127),x=t(6501);function g(){var e;let[s,t]=(0,r.useState)(""),[g,f]=(0,r.useState)(!1),[p,y]=(0,r.useState)(null),[w,b]=(0,r.useState)(null),[j,N]=(0,r.useState)(!0),v=(0,i.useRouter)();(0,r.useEffect)(()=>{k()},[]);let k=async()=>{let{isAdmin:e,user:s}=await (0,o.jW)(v,b,N)},_=async e=>{if(e.preventDefault(),!s){x.default.error("Please enter an email address");return}f(!0),y(null);try{let{data:e,error:r}=await l.OQ.from("allowed_users").select("*").eq("email",s.toLowerCase()).single(),{data:i,error:n}=await l.OQ.from("users").select("*").eq("email",s.toLowerCase()).single(),o=!1;try{let e=await fetch("/api/admin/check-auth-user",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:s.toLowerCase()})});o=(await e.json()).exists||!1}catch(e){console.error("Error checking auth user:",e);try{let{data:e}=await l.OQ.auth.signInWithPassword({email:s.toLowerCase(),password:"test-password-that-will-fail"})}catch(e){var t,a;o=(null===(t=e.message)||void 0===t?void 0:t.includes("Invalid login credentials"))||(null===(a=e.message)||void 0===a?void 0:a.includes("Invalid email or password"))}}let c={email:s.toLowerCase(),inAllowedList:!!e,allowedUserData:e,isUsed:(null==e?void 0:e.is_used)||!1,hasProfile:!!i,profileData:i,authUserExists:o,registrationStatus:S(e,i,o)};y(c)}catch(e){console.error("Error checking user status:",e),x.default.error("Failed to check user status")}finally{f(!1)}},S=(e,s,t)=>e?!e||e.is_used||t?e&&e.is_used&&t&&s?{status:"fully_registered",message:"User is fully registered and can login",action:"User can login normally",color:"green"}:e&&t&&!s?{status:"partial_registration",message:"User exists in auth but profile is incomplete",action:"Contact technical support - profile sync issue",color:"orange"}:{status:"unknown",message:"Unknown status - needs investigation",action:"Contact technical support",color:"gray"}:{status:"invited_not_registered",message:"User is invited but has not registered yet",action:"User needs to visit the registration page and create an account",color:"yellow"}:{status:"not_invited",message:"User is not in the allowed users list",action:"Add user to allowed users list first",color:"red"},C=e=>{switch(e){case"green":return"text-green-800";case"red":return"text-red-800";case"yellow":return"text-yellow-800";case"orange":return"text-orange-800";default:return"text-gray-800"}};return j?(0,a.jsx)(n.Z,{children:(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"loading-spinner mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-gray-600",children:"Loading admin panel..."})]})})}):(0,a.jsx)(n.Z,{children:(0,a.jsxs)("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8",children:[(0,a.jsxs)("div",{className:"mb-6 sm:mb-8",children:[(0,a.jsx)("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-900",children:"User Status Check"}),(0,a.jsx)("p",{className:"mt-2 text-sm sm:text-base text-gray-600",children:"Check the registration and login status of any user to help troubleshoot access issues."})]}),(0,a.jsx)("div",{className:"bg-white shadow rounded-lg p-4 sm:p-6 mb-6 sm:mb-8",children:(0,a.jsxs)("form",{onSubmit:_,className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700",children:"Email Address"}),(0,a.jsxs)("div",{className:"mt-1 relative",children:[(0,a.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,a.jsx)(m.Z,{className:"h-5 w-5 text-gray-400"})}),(0,a.jsx)("input",{id:"email",type:"email",value:s,onChange:e=>t(e.target.value),className:"appearance-none relative block w-full pl-10 pr-3 py-3 sm:py-2 border border-gray-300 placeholder-gray-400 text-gray-900 bg-white rounded-md focus:outline-none focus:ring-church-primary focus:border-church-primary text-base sm:text-sm",placeholder:"Enter user's email address",required:!0})]})]}),(0,a.jsxs)("button",{type:"submit",disabled:g,className:"inline-flex items-center justify-center px-4 py-3 sm:py-2 border border-transparent text-base sm:text-sm font-medium rounded-md text-white bg-church-primary hover:bg-church-secondary focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-church-primary disabled:opacity-50 min-h-[44px] w-full sm:w-auto",children:[g?(0,a.jsx)("div",{className:"loading-spinner w-4 h-4 mr-2"}):(0,a.jsx)(h.Z,{className:"h-4 w-4 mr-2"}),"Check Status"]})]})}),p&&(0,a.jsxs)("div",{className:"bg-white shadow-lg rounded-lg p-4 sm:p-6 lg:p-8",children:[(0,a.jsxs)("h2",{className:"text-xl sm:text-2xl font-semibold text-gray-900 mb-4 sm:mb-6 break-words",children:["Status for ",p.email]}),(0,a.jsxs)("div",{className:"space-y-4 sm:space-y-6",children:[(0,a.jsx)("div",{className:"p-4 rounded-md border-l-4 ".concat((e=>{switch(e){case"green":return"border-green-400";case"red":return"border-red-400";case"yellow":return"border-yellow-400";case"orange":return"border-orange-400";default:return"border-gray-400"}})(p.registrationStatus.color)," ").concat((e=>{switch(e){case"green":return"bg-green-50";case"red":return"bg-red-50";case"yellow":return"bg-yellow-50";case"orange":return"bg-orange-50";default:return"bg-gray-50"}})(p.registrationStatus.color)),children:(0,a.jsxs)("div",{className:"flex items-center",children:[(e=>{switch(e.color){case"green":return(0,a.jsx)(c.Z,{className:"h-5 w-5 text-green-500"});case"red":return(0,a.jsx)(d.Z,{className:"h-5 w-5 text-red-500"});case"yellow":case"orange":return(0,a.jsx)(u.Z,{className:"h-5 w-5 text-yellow-500"});default:return(0,a.jsx)(u.Z,{className:"h-5 w-5 text-gray-500"})}})(p.registrationStatus),(0,a.jsxs)("div",{className:"ml-3",children:[(0,a.jsx)("h3",{className:"text-sm font-medium ".concat(C(p.registrationStatus.color)),children:p.registrationStatus.message}),(0,a.jsxs)("p",{className:"text-sm ".concat(C(p.registrationStatus.color)," mt-1"),children:[(0,a.jsx)("strong",{children:"Action needed:"})," ",p.registrationStatus.action]})]})]})}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6",children:[(0,a.jsxs)("div",{className:"bg-gray-50 p-4 sm:p-5 rounded-md",children:[(0,a.jsx)("h4",{className:"font-medium text-gray-900 mb-2",children:"Invitation Status"}),(0,a.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:justify-between gap-1 sm:gap-0",children:[(0,a.jsx)("span",{className:"text-gray-700 font-medium",children:"In allowed users list:"}),(0,a.jsx)("span",{className:p.inAllowedList?"text-green-600 font-semibold":"text-red-600 font-semibold",children:p.inAllowedList?"Yes":"No"})]}),p.inAllowedList&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:justify-between gap-1 sm:gap-0",children:[(0,a.jsx)("span",{className:"text-gray-700 font-medium",children:"Invitation used:"}),(0,a.jsx)("span",{className:p.isUsed?"text-green-600 font-semibold":"text-yellow-600 font-semibold",children:p.isUsed?"Yes":"No"})]}),(null===(e=p.allowedUserData)||void 0===e?void 0:e.invitation_sent_at)&&(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:justify-between gap-1 sm:gap-0",children:[(0,a.jsx)("span",{className:"text-gray-700 font-medium",children:"Invited on:"}),(0,a.jsx)("span",{className:"text-gray-800 font-medium",children:new Date(p.allowedUserData.invitation_sent_at).toLocaleDateString()})]})]})]})]}),(0,a.jsxs)("div",{className:"bg-gray-50 p-4 sm:p-5 rounded-md",children:[(0,a.jsx)("h4",{className:"font-medium text-gray-900 mb-2",children:"Registration Status"}),(0,a.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:justify-between gap-1 sm:gap-0",children:[(0,a.jsx)("span",{className:"text-gray-700 font-medium",children:"Has user profile:"}),(0,a.jsx)("span",{className:p.hasProfile?"text-green-600 font-semibold":"text-red-600 font-semibold",children:p.hasProfile?"Yes":"No"})]}),(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:justify-between gap-1 sm:gap-0",children:[(0,a.jsx)("span",{className:"text-gray-700 font-medium",children:"Can login:"}),(0,a.jsx)("span",{className:p.authUserExists?"text-green-600 font-semibold":"text-red-600 font-semibold",children:p.authUserExists?"Yes":"No"})]})]})]})]}),(0,a.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-md p-4",children:[(0,a.jsx)("h4",{className:"font-medium text-blue-900 mb-2",children:"Instructions for User"}),(0,a.jsxs)("div",{className:"text-sm text-blue-800",children:["not_invited"===p.registrationStatus.status&&(0,a.jsx)("p",{children:'This user needs to be added to the allowed users list first. Go to the "Allowed Users" page and add their email address.'}),"invited_not_registered"===p.registrationStatus.status&&(0,a.jsxs)("p",{children:["Tell the user to visit the registration page and create an account using the email address: ",(0,a.jsx)("strong",{children:p.email})]}),"fully_registered"===p.registrationStatus.status&&(0,a.jsx)("p",{children:"User can login normally at the login page. If they're having trouble, they may need to reset their password."}),"partial_registration"===p.registrationStatus.status&&(0,a.jsx)("p",{children:"There's a technical issue with this user's profile. Contact technical support."})]})]})]})]})]})})}}},function(e){e.O(0,[5285,4733,2888,9774,179],function(){return e(e.s=8476)}),_N_E=e.O()}]);