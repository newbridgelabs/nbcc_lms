(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6367],{749:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/content/[section_id]",function(){return r(1947)}])},7448:function(e,t,r){"use strict";r.d(t,{Z:function(){return c}});var n=r(5893),a=r(7294);let s=(0,r(3759).Z)("Volume2",[["polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5",key:"16drj5"}],["path",{d:"M15.54 8.46a5 5 0 0 1 0 7.07",key:"ltjumu"}],["path",{d:"M19.07 4.93a10 10 0 0 1 0 14.14",key:"1kegas"}]]);var o=r(1707),l=r(2779);function c(e){let{content:t}=e,[r,c]=(0,a.useState)(!1),i=()=>{let{html:e,plain_text:r}=t.content_data;return(0,n.jsx)("div",{className:"prose prose-lg max-w-none",children:e?(0,n.jsx)("div",{dangerouslySetInnerHTML:{__html:e}}):(0,n.jsx)("div",{className:"whitespace-pre-wrap",children:r})})},d=()=>{let{url:e,alt_text:r,caption:a,width:s,height:o}=t.content_data;return(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("img",{src:e,alt:r||t.title||"Image",className:"max-w-full h-auto rounded-lg shadow-lg mx-auto",style:{maxWidth:s?"".concat(s,"px"):"100%",maxHeight:o?"".concat(o,"px"):"auto"}}),a&&(0,n.jsx)("p",{className:"text-sm text-gray-600 mt-2 italic",children:a})]})},u=()=>{let{url:e,embed_url:r,thumbnail:a,duration:s,description:o}=t.content_data;if(e&&e.includes("youtube.com")){var l;let a=null===(l=e.match(/(?:youtube\.com\/watch\?v=|youtu\.be\/)([^&\n?#]+)/))||void 0===l?void 0:l[1];return(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsx)("div",{className:"relative aspect-video",children:(0,n.jsx)("iframe",{src:a?"https://www.youtube.com/embed/".concat(a):r,title:t.title||"Video",className:"w-full h-full rounded-lg",frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0})}),o&&(0,n.jsx)("p",{className:"text-sm text-gray-600",children:o}),s&&(0,n.jsxs)("p",{className:"text-xs text-gray-500",children:["Duration: ",s]})]})}return(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsxs)("video",{controls:!0,className:"w-full rounded-lg",poster:a,children:[(0,n.jsx)("source",{src:e,type:"video/mp4"}),"Your browser does not support the video tag."]}),o&&(0,n.jsx)("p",{className:"text-sm text-gray-600",children:o})]})},m=()=>{let{url:e,duration:r,transcript:a}=t.content_data;return(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,n.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,n.jsx)(s,{className:"h-6 w-6 text-gray-600"}),(0,n.jsx)("div",{className:"flex-1",children:(0,n.jsxs)("audio",{controls:!0,className:"w-full",children:[(0,n.jsx)("source",{src:e,type:"audio/mpeg"}),"Your browser does not support the audio element."]})})]}),r&&(0,n.jsxs)("p",{className:"text-xs text-gray-500 mt-2",children:["Duration: ",r]})]}),a&&(0,n.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,n.jsx)("h4",{className:"font-medium text-gray-900 mb-2",children:"Transcript"}),(0,n.jsx)("p",{className:"text-sm text-gray-700 whitespace-pre-wrap",children:a})]})]})},x=()=>{let{url:e,filename:r,page_count:a}=t.content_data;return(0,n.jsxs)("div",{className:"border border-gray-200 rounded-lg p-6 bg-gray-50",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h4",{className:"font-medium text-gray-900",children:r||"PDF Document"}),a&&(0,n.jsxs)("p",{className:"text-sm text-gray-600",children:[a," pages"]})]}),(0,n.jsxs)("div",{className:"flex space-x-2",children:[(0,n.jsxs)("a",{href:e,target:"_blank",rel:"noopener noreferrer",className:"flex items-center px-3 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:[(0,n.jsx)(o.Z,{className:"h-4 w-4 mr-2"}),"View"]}),(0,n.jsxs)("a",{href:e,download:r,className:"flex items-center px-3 py-2 bg-gray-600 text-white rounded hover:bg-gray-700",children:[(0,n.jsx)(l.Z,{className:"h-4 w-4 mr-2"}),"Download"]})]})]}),(0,n.jsx)("div",{className:"mt-4",children:(0,n.jsx)("iframe",{src:e,className:"w-full h-96 border border-gray-300 rounded",title:r||"PDF Document"})})]})},h=()=>{let{embed_code:e,source:r,url:a}=t.content_data;return(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsx)("div",{className:"embed-container",dangerouslySetInnerHTML:{__html:e}}),r&&(0,n.jsxs)("p",{className:"text-xs text-gray-500",children:["Source: ",r]}),a&&(0,n.jsx)("a",{href:a,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline text-sm",children:"View original"})]})};return(0,n.jsxs)("div",{className:"multimedia-content-item mb-8",children:[t.title&&(0,n.jsx)("h3",{className:"text-xl font-semibold text-gray-900 mb-4",children:t.title}),(0,n.jsx)("div",{className:"content-body",children:(()=>{switch(t.content_type){case"text":return i();case"image":return d();case"video":return u();case"audio":return m();case"pdf":return x();case"embed":return h();default:return(0,n.jsxs)("div",{className:"text-gray-500",children:["Unsupported content type: ",t.content_type]})}})()})]})}},7298:function(e,t,r){"use strict";r.d(t,{KO:function(){return l},L$:function(){return i},oN:function(){return s},sN:function(){return a},t7:function(){return o},zy:function(){return c}});var n=r(9495);let a=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5;try{let r=await e.arrayBuffer(),a=await n.PDFDocument.load(r),s=a.getPageCount(),o=Math.ceil(s/t),l=[];for(let e=0;e<t;e++){let t=e*o,r=Math.min(t+o-1,s-1);if(t<s){let s=await n.PDFDocument.create();for(let e=t;e<=r;e++){let[t]=await s.copyPages(a,[e]);s.addPage(t)}let o=await s.save();l.push({sectionNumber:e+1,title:"Section ".concat(e+1," (Pages ").concat(t+1,"-").concat(r+1,")"),content:o,pageRange:"".concat(t+1,"-").concat(r+1),totalPages:r-t+1})}}return{sections:l,error:null}}catch(e){return console.error("Error splitting PDF:",e),{sections:null,error:e}}},s=async(e,t)=>{try{console.log("Starting PDF sections upload...");let{data:{session:r}}=await t.auth.getSession();if(!(null==r?void 0:r.access_token))throw Error("No authentication token available");console.log("Session token available, preparing upload...");let n={sections:e.map(t=>({title:t.title,section_number:t.sectionNumber,total_sections:e.length,content:Array.from(new Uint8Array(t.content))}))};console.log("Sending request to upload API...");let a=await fetch("/api/admin/upload-sections",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(r.access_token)},body:JSON.stringify(n)});if(console.log("Upload API response status:",a.status),!a.ok){let e="Failed to upload sections";try{let t=await a.json();e=t.error||e,console.error("Upload API error:",t)}catch(r){let t=await a.text();console.error("Upload API returned non-JSON response:",t),e=t.includes("<html>")||t.includes("<!DOCTYPE")?"Server returned HTML instead of JSON. Check server logs for authentication issues.":"Server error: ".concat(a.status," ").concat(a.statusText)}throw Error(e)}let s=await a.json();return console.log("Upload successful:",s),{sections:s.sections,error:null}}catch(e){return console.error("Error uploading sections:",e),{sections:null,error:e}}},o=async e=>{try{if(!e)return{sections:[],error:null};let{data:t,error:r}=await e.from("pdf_sections").select("*").order("section_number");if(r)throw r;return{sections:t,error:null}}catch(e){return{sections:null,error:e}}},l=async(e,t)=>{try{if(console.log("Getting PDF URL for file path:",e),!e)return console.error("No file path provided"),null;let{data:r}=t.storage.from("pdf-sections").getPublicUrl(e);if(console.log("Generated public URL:",null==r?void 0:r.publicUrl),null==r?void 0:r.publicUrl)return console.log("Returning public URL:",r.publicUrl),r.publicUrl;return null}catch(e){return console.error("Error getting PDF URL:",e),null}},c=async(e,t,r)=>{try{if(console.log("Marking section complete:",{userId:e,sectionId:t}),!e||!t)throw Error("User ID and Section ID are required");let r=await fetch("/api/complete-section",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:e,sectionId:t})}),n=await r.json();if(!r.ok)throw Error(n.error||"Failed to complete section");return console.log("Section marked complete successfully:",n.data),{data:n.data,error:null}}catch(e){return console.error("Error marking section complete:",e),{data:null,error:e}}},i=async(e,t)=>{try{if(!t||!e)return{progress:[],error:null};console.log("Getting user progress for userId:",e);let{data:r,error:n}=await t.from("user_progress").select("\n        *,\n        pdf_sections (\n          id,\n          title,\n          section_number,\n          total_sections\n        )\n      ").eq("user_id",e);if(n)throw console.error("Error fetching user progress:",n),n;console.log("Raw progress data:",r);let a=(null==r?void 0:r.filter(e=>null!==e.pdf_sections))||[];return console.log("Valid progress data:",a),{progress:a,error:null}}catch(e){return console.error("getUserProgress error:",e),{progress:null,error:e}}}},2779:function(e,t,r){"use strict";r.d(t,{Z:function(){return n}});let n=(0,r(3759).Z)("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]])},6815:function(e,t,r){"use strict";r.d(t,{Z:function(){return n}});let n=(0,r(3759).Z)("PenSquare",[["path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1qinfi"}],["path",{d:"M18.5 2.5a2.12 2.12 0 0 1 3 3L12 15l-4 1 1-4Z",key:"w2jsv5"}]])},4270:function(e,t,r){"use strict";r.d(t,{Z:function(){return n}});let n=(0,r(3759).Z)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},9819:function(e,t,r){"use strict";r.d(t,{Z:function(){return n}});let n=(0,r(3759).Z)("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]])},7864:function(e,t,r){"use strict";r.d(t,{Z:function(){return n}});let n=(0,r(3759).Z)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]])},1947:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return j}});var n=r(5893),a=r(7294),s=r(1163),o=r(4733),l=r(7448),c=r(1046),i=r(7298),d=r(9819),u=r(2190),m=r(4270),x=r(3759);let h=(0,x.Z)("ArrowUp",[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]]),p=(0,x.Z)("ArrowDown",[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]]);var y=r(6815),g=r(7864),f=r(6501);function j(){let e=(0,s.useRouter)(),{section_id:t}=e.query,[r,x]=(0,a.useState)(null),[j,b]=(0,a.useState)([]),[v,N]=(0,a.useState)(!0),[w,_]=(0,a.useState)(!1),[k,C]=(0,a.useState)(null),[E,S]=(0,a.useState)({content_type:"text",title:"",content_data:{}});(0,a.useEffect)(()=>{t&&P()},[t]);let P=async()=>{try{let{sections:e}=await (0,i.t7)(c.OQ),r=null==e?void 0:e.find(e=>e.id===t);x(r);let n=await fetch("/api/admin/multimedia-content?section_id=".concat(t)),a=await n.json();if(n.ok)b(a.content||[]);else throw Error(a.error)}catch(e){console.error("Error loading content:",e),f.default.error("Failed to load content")}finally{N(!1)}},Z=async()=>{try{let e=await fetch("/api/admin/multimedia-content",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({section_id:t,...E})}),r=await e.json();if(e.ok)b([...j,r.content]),S({content_type:"text",title:"",content_data:{}}),_(!1),f.default.success("Content added successfully");else throw Error(r.error)}catch(e){console.error("Error adding content:",e),f.default.error("Failed to add content")}},D=async(e,t)=>{try{let r=await fetch("/api/admin/multimedia-content",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e,...t})}),n=await r.json();if(r.ok)b(j.map(t=>t.id===e?n.content:t)),C(null),f.default.success("Content updated successfully");else throw Error(n.error)}catch(e){console.error("Error updating content:",e),f.default.error("Failed to update content")}},U=async e=>{if(confirm("Are you sure you want to delete this content?"))try{let t=await fetch("/api/admin/multimedia-content?id=".concat(e),{method:"DELETE"});if(t.ok)b(j.filter(t=>t.id!==e)),f.default.success("Content deleted successfully");else{let e=await t.json();throw Error(e.error)}}catch(e){console.error("Error deleting content:",e),f.default.error("Failed to delete content")}},T=async(e,t)=>{let r=j.findIndex(t=>t.id===e),n="up"===t?r-1:r+1;if(n<0||n>=j.length)return;let a=[...j],[s]=a.splice(r,1);a.splice(n,0,s);let o=a.map((e,t)=>({id:e.id,display_order:t}));try{for(let e of o)await D(e.id,{display_order:e.display_order});await P()}catch(e){console.error("Error reordering content:",e),f.default.error("Failed to reorder content")}},M=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=e||E;return(0,n.jsx)("div",{className:"bg-white border border-gray-200 rounded-lg p-6",children:(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Content Type"}),(0,n.jsxs)("select",{value:r.content_type,onChange:e=>{let n={...r,content_type:e.target.value,content_data:{}};t?C(n):S(n)},className:"w-full border border-gray-300 rounded-md px-3 py-2",children:[(0,n.jsx)("option",{value:"text",children:"Rich Text"}),(0,n.jsx)("option",{value:"image",children:"Image"}),(0,n.jsx)("option",{value:"video",children:"Video"}),(0,n.jsx)("option",{value:"audio",children:"Audio"}),(0,n.jsx)("option",{value:"pdf",children:"PDF Document"}),(0,n.jsx)("option",{value:"embed",children:"Embed Code"})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Title (Optional)"}),(0,n.jsx)("input",{type:"text",value:r.title||"",onChange:e=>{let n={...r,title:e.target.value};t?C(n):S(n)},className:"w-full border border-gray-300 rounded-md px-3 py-2",placeholder:"Enter content title"})]}),"text"===r.content_type&&(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Content"}),(0,n.jsx)("textarea",{value:r.content_data.plain_text||"",onChange:e=>{let n={...r,content_data:{...r.content_data,plain_text:e.target.value}};t?C(n):S(n)},rows:6,className:"w-full border border-gray-300 rounded-md px-3 py-2",placeholder:"Enter your text content"})]}),("image"===r.content_type||"video"===r.content_type||"audio"===r.content_type||"pdf"===r.content_type)&&(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"URL"}),(0,n.jsx)("input",{type:"url",value:r.content_data.url||"",onChange:e=>{let n={...r,content_data:{...r.content_data,url:e.target.value}};t?C(n):S(n)},className:"w-full border border-gray-300 rounded-md px-3 py-2",placeholder:"Enter URL"})]}),"embed"===r.content_type&&(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Embed Code"}),(0,n.jsx)("textarea",{value:r.content_data.embed_code||"",onChange:e=>{let n={...r,content_data:{...r.content_data,embed_code:e.target.value}};t?C(n):S(n)},rows:4,className:"w-full border border-gray-300 rounded-md px-3 py-2",placeholder:"Paste embed code here"})]}),(0,n.jsxs)("div",{className:"flex space-x-4",children:[(0,n.jsxs)("button",{onClick:t?()=>D(r.id,{title:r.title,content_data:r.content_data}):Z,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:[(0,n.jsx)(d.Z,{className:"h-4 w-4 mr-2 inline"}),t?"Update":"Add"," Content"]}),(0,n.jsxs)("button",{onClick:()=>{t?C(null):_(!1),t||S({content_type:"text",title:"",content_data:{}})},className:"px-4 py-2 border border-gray-300 text-gray-700 rounded hover:bg-gray-50",children:[(0,n.jsx)(u.Z,{className:"h-4 w-4 mr-2 inline"}),"Cancel"]})]})]})})};return v?(0,n.jsx)(o.Z,{children:(0,n.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,n.jsx)("div",{className:"loading-spinner"})})}):(0,n.jsx)(o.Z,{children:(0,n.jsx)("div",{className:"min-h-screen bg-gray-50",children:(0,n.jsxs)("div",{className:"max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,n.jsx)("div",{className:"mb-8",children:(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Manage Section Content"}),(0,n.jsx)("p",{className:"mt-2 text-gray-600",children:r?"".concat(r.title," - Section ").concat(r.section_number):"Loading..."})]}),(0,n.jsx)("button",{onClick:()=>e.push("/admin"),className:"px-4 py-2 border border-gray-300 text-gray-700 rounded hover:bg-gray-50",children:"Back to Admin"})]})}),!w&&(0,n.jsx)("div",{className:"mb-6",children:(0,n.jsxs)("button",{onClick:()=>_(!0),className:"flex items-center px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:[(0,n.jsx)(m.Z,{className:"h-4 w-4 mr-2"}),"Add Content"]})}),w&&(0,n.jsxs)("div",{className:"mb-8",children:[(0,n.jsx)("h2",{className:"text-lg font-semibold mb-4",children:"Add New Content"}),M()]}),(0,n.jsx)("div",{className:"space-y-6",children:0===j.length?(0,n.jsx)("div",{className:"bg-white rounded-lg shadow p-8 text-center",children:(0,n.jsx)("p",{className:"text-gray-500",children:'No content added yet. Click "Add Content" to get started.'})}):j.map((e,t)=>(0,n.jsxs)("div",{className:"bg-white rounded-lg shadow",children:[(0,n.jsx)("div",{className:"border-b border-gray-200 p-4",children:(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,n.jsxs)("span",{className:"text-sm text-gray-500",children:["#",t+1]}),(0,n.jsx)("span",{className:"px-2 py-1 bg-gray-100 text-gray-800 text-xs rounded",children:e.content_type.toUpperCase()}),e.title&&(0,n.jsx)("span",{className:"font-medium text-gray-900",children:e.title})]}),(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)("button",{onClick:()=>T(e.id,"up"),disabled:0===t,className:"p-1 text-gray-400 hover:text-gray-600 disabled:opacity-50",children:(0,n.jsx)(h,{className:"h-4 w-4"})}),(0,n.jsx)("button",{onClick:()=>T(e.id,"down"),disabled:t===j.length-1,className:"p-1 text-gray-400 hover:text-gray-600 disabled:opacity-50",children:(0,n.jsx)(p,{className:"h-4 w-4"})}),(0,n.jsx)("button",{onClick:()=>C(e),className:"p-1 text-blue-600 hover:text-blue-800",children:(0,n.jsx)(y.Z,{className:"h-4 w-4"})}),(0,n.jsx)("button",{onClick:()=>U(e.id),className:"p-1 text-red-600 hover:text-red-800",children:(0,n.jsx)(g.Z,{className:"h-4 w-4"})})]})]})}),(0,n.jsx)("div",{className:"p-6",children:(null==k?void 0:k.id)===e.id?M(k,!0):(0,n.jsx)(l.Z,{content:e})})]},e.id))})]})})})}}},function(e){e.O(0,[5285,9495,4733,2888,9774,179],function(){return e(e.s=749)}),_N_E=e.O()}]);