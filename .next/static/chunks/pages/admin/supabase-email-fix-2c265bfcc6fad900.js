(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9659],{2721:function(e,s,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/supabase-email-fix",function(){return a(9923)}])},493:function(e,s,a){"use strict";a.d(s,{Z:function(){return t}});let t=(0,a(3759).Z)("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},8289:function(e,s,a){"use strict";a.d(s,{Z:function(){return t}});let t=(0,a(3759).Z)("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]])},6691:function(e,s,a){"use strict";a.d(s,{Z:function(){return t}});let t=(0,a(3759).Z)("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]])},5264:function(e,s,a){"use strict";a.d(s,{Z:function(){return t}});let t=(0,a(3759).Z)("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]])},9475:function(e,s,a){"use strict";a.d(s,{Z:function(){return t}});let t=(0,a(3759).Z)("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]])},9923:function(e,s,a){"use strict";a.r(s),a.d(s,{default:function(){return g}});var t=a(5893),i=a(7294),n=a(4733),l=a(1046),r=a(6691),o=a(9200),c=a(8289),d=a(1707),m=a(5264),u=a(493),h=a(9475),p=a(6501);function g(){let[e,s]=(0,i.useState)(!1),[a,g]=(0,i.useState)("alenps76@gmail.com"),[b,f]=(0,i.useState)([]),[x,y]=(0,i.useState)(null);(0,i.useEffect)(()=>{v()},[]);let j=e=>{f(s=>[...s,{...e,timestamp:new Date().toLocaleTimeString()}])},v=()=>{var e,s;y({url:"https://qyhdzjzvkggcsuhnenaz.supabase.co",projectId:null===(e="https://qyhdzjzvkggcsuhnenaz.supabase.co".split("//")[1])||void 0===e?void 0:e.split(".")[0],dashboardUrl:"https://supabase.com/dashboard/project/".concat(null===(s="https://qyhdzjzvkggcsuhnenaz.supabase.co".split("//")[1])||void 0===s?void 0:s.split(".")[0])})},w=async()=>{s(!0),f([]);try{j({type:"Info",success:!0,message:"Testing Supabase email confirmation for ".concat(a),details:{}});let{data:s,error:i}=await l.OQ.from("allowed_users").select("*").eq("email",a.toLowerCase()).single();if(i||!s){j({type:"Step 1",success:!1,message:"User not in allowed_users table",details:{error:null==i?void 0:i.message}});return}j({type:"Step 1",success:!0,message:"User found in allowed_users table",details:s}),j({type:"Step 2",success:!0,message:"Testing Supabase email verification...",details:{}});let{error:n}=await l.OQ.auth.resend({type:"signup",email:a,options:{emailRedirectTo:"".concat(window.location.origin,"/auth/callback")}});if(n){var e,t;j({type:"Step 2",success:!1,message:"Supabase email verification failed",details:{error:n.message,code:n.status,suggestion:"Supabase email service not configured properly"}}),(null===(e=n.message)||void 0===e?void 0:e.includes("rate limit"))?j({type:"Solution",success:!1,message:"Rate limit exceeded - wait before trying again",details:{waitTime:"60 seconds"}}):(null===(t=n.message)||void 0===t?void 0:t.includes("not found"))?j({type:"Solution",success:!1,message:"User not found in Supabase Auth - needs to register first",details:{}}):j({type:"Solution",success:!1,message:"Supabase email service not configured - see configuration steps below",details:{}})}else j({type:"Step 2",success:!0,message:"Supabase email sent successfully!",details:{email:a}})}catch(e){j({type:"Error",success:!1,message:"Test failed with error",details:{error:e.message}})}finally{s(!1)}},S=async()=>{try{j({type:"Workaround",success:!0,message:"Attempting to disable email confirmation requirement...",details:{}}),j({type:"Workaround",success:!1,message:"Cannot disable from client - manual configuration required",details:{instruction:'Go to Supabase Dashboard → Authentication → Settings → Email and disable "Enable email confirmations"'}}),p.default.info("Manual configuration required - see results for instructions")}catch(e){j({type:"Error",success:!1,message:"Workaround failed",details:{error:e.message}})}};return(0,t.jsx)(n.Z,{children:(0,t.jsx)("div",{className:"min-h-screen bg-gray-50 py-8",children:(0,t.jsxs)("div",{className:"max-w-4xl mx-auto px-4",children:[(0,t.jsxs)("div",{className:"bg-white rounded-lg shadow p-6 mb-6",children:[(0,t.jsxs)("h1",{className:"text-2xl font-bold mb-6 flex items-center",children:[(0,t.jsx)(r.Z,{className:"h-6 w-6 mr-2 text-blue-600"}),"Supabase Email Confirmation Fix"]}),(0,t.jsx)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-md p-4 mb-6",children:(0,t.jsxs)("div",{className:"flex",children:[(0,t.jsx)(o.Z,{className:"h-5 w-5 text-yellow-400 mr-2 mt-0.5"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"text-sm font-medium text-yellow-800",children:"Email Confirmation Issue Detected"}),(0,t.jsx)("p",{className:"mt-1 text-sm text-yellow-700",children:'Users are not receiving "confirm your signup" emails. This is a Supabase configuration issue, separate from EmailJS which is working fine for agreement notifications.'})]})]})}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Test Email Address"}),(0,t.jsx)("input",{type:"email",value:a,onChange:e=>g(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter email to test"})]}),(0,t.jsx)("div",{className:"flex space-x-2",children:(0,t.jsx)("button",{onClick:w,disabled:e||!a,className:"flex-1 bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 disabled:opacity-50",children:e?"Testing...":"Test Supabase Email"})})]}),(0,t.jsxs)("div",{className:"bg-gray-50 p-4 rounded-md",children:[(0,t.jsx)("h3",{className:"font-medium text-gray-900 mb-2",children:"Quick Actions"}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("button",{onClick:()=>{let e="\n# Supabase Email Configuration Steps\n\n## 1. Go to Supabase Dashboard\nURL: ".concat(null==x?void 0:x.dashboardUrl,'\n\n## 2. Navigate to Authentication Settings\nPath: Authentication → Settings → Email\n\n## 3. Configure Email Service\n\n### Option A: Use Supabase Email Service (Default)\n- Enable "Enable email confirmations"\n- Set Site URL: ').concat(window.location.origin,"\n- Set Redirect URLs: ").concat(window.location.origin,'/auth/callback\n\n### Option B: Configure Custom SMTP (Recommended)\n- Enable "Enable custom SMTP"\n- SMTP Host: smtp.gmail.com\n- SMTP Port: 587\n- SMTP User: your-email@gmail.com\n- SMTP Password: your-app-password\n- Sender Name: NBCC Church\n- Sender Email: your-email@gmail.com\n\n## 4. Update Email Templates\nPath: Authentication → Email Templates\n\n### Confirm Signup Template:\nSubject: Confirm your signup\nBody: \n<h2>Confirm your signup</h2>\n<p>Follow this link to confirm your user:</p>\n<p><a href="{{ .SiteURL }}/auth/callback?token_hash={{ .TokenHash }}&type=signup">Confirm your mail</a></p>\n\n## 5. Test Configuration\n- Use the test tool in this page\n- Check email delivery\n- Verify redirect URLs work\n\n## Current Project Info:\nProject ID: ').concat(null==x?void 0:x.projectId,"\nSite URL: ").concat(window.location.origin,"\nCallback URL: ").concat(window.location.origin,"/auth/callback\n    ").trim();"undefined"!=typeof navigator&&navigator.clipboard?navigator.clipboard.writeText(e).then(()=>{p.default.success("Configuration guide copied to clipboard!")}).catch(()=>{p.default.error("Could not copy to clipboard")}):p.default.error("Clipboard not available")},className:"w-full bg-green-600 text-white py-2 px-3 rounded-md hover:bg-green-700 text-sm flex items-center justify-center",children:[(0,t.jsx)(c.Z,{className:"h-4 w-4 mr-1"}),"Copy Configuration Guide"]}),(0,t.jsxs)("a",{href:null==x?void 0:x.dashboardUrl,target:"_blank",rel:"noopener noreferrer",className:"w-full bg-purple-600 text-white py-2 px-3 rounded-md hover:bg-purple-700 text-sm flex items-center justify-center",children:[(0,t.jsx)(d.Z,{className:"h-4 w-4 mr-1"}),"Open Supabase Dashboard"]}),(0,t.jsxs)("button",{onClick:S,className:"w-full bg-orange-600 text-white py-2 px-3 rounded-md hover:bg-orange-700 text-sm flex items-center justify-center",children:[(0,t.jsx)(m.Z,{className:"h-4 w-4 mr-1"}),"Disable Email Confirmation"]})]})]})]})]}),b.length>0&&(0,t.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,t.jsx)("h2",{className:"text-lg font-semibold mb-4",children:"Test Results"}),(0,t.jsx)("div",{className:"space-y-3",children:b.map((e,s)=>(0,t.jsx)("div",{className:"p-3 rounded-md border-l-4 ".concat(e.success?"border-green-400 bg-green-50":"border-red-400 bg-red-50"),children:(0,t.jsxs)("div",{className:"flex items-start",children:[e.success?(0,t.jsx)(u.Z,{className:"h-5 w-5 text-green-500 mr-2 mt-0.5"}):(0,t.jsx)(h.Z,{className:"h-5 w-5 text-red-500 mr-2 mt-0.5"}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsxs)("div",{className:"flex justify-between items-start",children:[(0,t.jsxs)("span",{className:"font-medium text-gray-900",children:["[",e.type,"] ",e.message]}),(0,t.jsx)("span",{className:"text-xs text-gray-500",children:e.timestamp})]}),e.details&&Object.keys(e.details).length>0&&(0,t.jsx)("pre",{className:"mt-2 text-xs text-gray-600 bg-white p-2 rounded border overflow-x-auto",children:JSON.stringify(e.details,null,2)})]})]})},s))})]}),(0,t.jsxs)("div",{className:"mt-6 bg-white rounded-lg shadow p-6",children:[(0,t.jsx)("h2",{className:"text-lg font-semibold mb-4",children:"Configuration Steps"}),(0,t.jsxs)("div",{className:"space-y-4 text-sm",children:[(0,t.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-md p-4",children:[(0,t.jsx)("h3",{className:"font-medium text-blue-900 mb-2",children:"Step 1: Configure Supabase Email"}),(0,t.jsxs)("ol",{className:"list-decimal list-inside space-y-1 text-blue-800",children:[(0,t.jsx)("li",{children:"Go to Supabase Dashboard → Authentication → Settings"}),(0,t.jsx)("li",{children:'Enable "Enable email confirmations"'}),(0,t.jsxs)("li",{children:["Set Site URL: ",window.location.origin]}),(0,t.jsxs)("li",{children:["Add Redirect URL: ",window.location.origin,"/auth/callback"]}),(0,t.jsx)("li",{children:"Configure SMTP settings (recommended) or use Supabase email service"})]})]}),(0,t.jsxs)("div",{className:"bg-green-50 border border-green-200 rounded-md p-4",children:[(0,t.jsx)("h3",{className:"font-medium text-green-900 mb-2",children:"Step 2: Test Email Delivery"}),(0,t.jsxs)("ul",{className:"list-disc list-inside space-y-1 text-green-800",children:[(0,t.jsx)("li",{children:"Use the test tool above to verify email sending"}),(0,t.jsx)("li",{children:"Check spam folders"}),(0,t.jsx)("li",{children:"Verify email templates are configured correctly"})]})]}),(0,t.jsxs)("div",{className:"bg-orange-50 border border-orange-200 rounded-md p-4",children:[(0,t.jsx)("h3",{className:"font-medium text-orange-900 mb-2",children:"Alternative: Disable Email Confirmation"}),(0,t.jsx)("p",{className:"text-orange-800",children:'If email configuration is too complex, you can disable email confirmation in Supabase Dashboard → Authentication → Settings → Email and uncheck "Enable email confirmations". Users will be able to register without email verification.'})]})]})]})]})})})}}},function(e){e.O(0,[5285,4733,2888,9774,179],function(){return e(e.s=2721)}),_N_E=e.O()}]);