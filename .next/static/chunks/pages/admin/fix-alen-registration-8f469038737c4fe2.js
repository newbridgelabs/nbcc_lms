(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9118],{1971:function(e,s,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/fix-alen-registration",function(){return t(5991)}])},493:function(e,s,t){"use strict";t.d(s,{Z:function(){return r}});let r=(0,t(3759).Z)("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},3616:function(e,s,t){"use strict";t.d(s,{Z:function(){return r}});let r=(0,t(3759).Z)("Key",[["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["path",{d:"m15.5 7.5 3 3L22 7l-3-3",key:"1rn1fs"}]])},6691:function(e,s,t){"use strict";t.d(s,{Z:function(){return r}});let r=(0,t(3759).Z)("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]])},8267:function(e,s,t){"use strict";t.d(s,{Z:function(){return r}});let r=(0,t(3759).Z)("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]])},9475:function(e,s,t){"use strict";t.d(s,{Z:function(){return r}});let r=(0,t(3759).Z)("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]])},5991:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return h}});var r=t(5893),a=t(7294),l=t(4733),i=t(1046),n=t(8267),o=t(493),c=t(9475),d=t(3616),u=t(6691),m=t(6501);function h(){let[e,s]=(0,a.useState)(!1),[t,h]=(0,a.useState)(null),[x,f]=(0,a.useState)(!1),g="alenps76@gmail.com";(0,a.useEffect)(()=>{w()},[]);let w=async()=>{s(!0);try{let{data:e,error:s}=await i.OQ.from("allowed_users").select("*").eq("email",g.toLowerCase()).single(),{data:t,error:r}=await i.OQ.from("users").select("*").eq("email",g.toLowerCase()).single();h({allowedUser:e||null,allowedError:(null==s?void 0:s.message)||null,userProfile:t||null,userError:(null==r?void 0:r.message)||null,canRegister:e&&!e.is_used,hasProfile:!!t})}catch(e){console.error("Error checking Alen status:",e),m.default.error("Failed to check status")}finally{s(!1)}},p=async()=>{f(!0);try{let e=[];if(t.allowedUser){if(t.allowedUser.is_used){e.push("Resetting registration status...");let{error:s}=await i.OQ.from("allowed_users").update({is_used:!1,manual_verification:!0,reset_at:new Date().toISOString()}).eq("email",g.toLowerCase());if(s)throw Error("Failed to reset status: "+s.message);e.push("✅ Reset registration status")}}else{e.push("Adding Alen to allowed_users...");let{data:s,error:t}=await i.OQ.from("allowed_users").insert({email:g.toLowerCase(),full_name:"Alen PS",invited_by:"admin",invitation_sent_at:new Date().toISOString(),is_used:!1,manual_verification:!0}).select().single();if(t)throw Error("Failed to add to allowed_users: "+t.message);e.push("✅ Added to allowed_users")}if(t.userProfile){e.push("Cleaning up existing profile...");let{error:s}=await i.OQ.from("users").delete().eq("email",g.toLowerCase());s?(console.warn("Could not delete existing profile:",s.message),e.push("⚠️ Could not clean existing profile (may need manual cleanup)")):e.push("✅ Cleaned up existing profile")}e.push("Testing registration eligibility...");let{data:s,error:r}=await i.OQ.rpc("check_allowed_user",{user_email:g.toLowerCase()});if(r)throw Error("Registration check failed: "+r.message);if(s&&s.length>0)e.push("✅ Registration eligibility confirmed");else throw Error("Registration check failed - user not eligible");m.default.success("Alen's registration has been fixed! He can now register."),e.forEach(e=>{console.log(e)}),await w()}catch(e){console.error("Fix failed:",e),m.default.error("Fix failed: "+e.message)}finally{f(!1)}};return e?(0,r.jsx)(l.Z,{children:(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"loading-spinner mx-auto mb-4"}),(0,r.jsx)("p",{className:"text-gray-600",children:"Checking Alen's status..."})]})})}):(0,r.jsx)(l.Z,{children:(0,r.jsx)("div",{className:"min-h-screen bg-gray-50 py-8",children:(0,r.jsx)("div",{className:"max-w-2xl mx-auto px-4",children:(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,r.jsxs)("h1",{className:"text-2xl font-bold mb-6 flex items-center",children:[(0,r.jsx)(n.Z,{className:"h-6 w-6 mr-2 text-blue-600"}),"Fix Alen's Registration"]}),(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsxs)("h2",{className:"text-lg font-semibold mb-4",children:["Current Status for ",g]}),t&&(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"bg-gray-50 p-4 rounded-md",children:[(0,r.jsx)("h3",{className:"font-medium text-gray-900 mb-2",children:"Allowed Users Status"}),(0,r.jsxs)("div",{className:"flex items-center",children:[t.allowedUser?(0,r.jsx)(o.Z,{className:"h-5 w-5 text-green-500 mr-2"}):(0,r.jsx)(c.Z,{className:"h-5 w-5 text-red-500 mr-2"}),(0,r.jsx)("span",{className:"text-sm",children:t.allowedUser?"In allowed list (Used: ".concat(t.allowedUser.is_used?"Yes":"No",")"):"Not in allowed list"})]})]}),(0,r.jsxs)("div",{className:"bg-gray-50 p-4 rounded-md",children:[(0,r.jsx)("h3",{className:"font-medium text-gray-900 mb-2",children:"User Profile Status"}),(0,r.jsxs)("div",{className:"flex items-center",children:[t.hasProfile?(0,r.jsx)(o.Z,{className:"h-5 w-5 text-green-500 mr-2"}):(0,r.jsx)(c.Z,{className:"h-5 w-5 text-red-500 mr-2"}),(0,r.jsx)("span",{className:"text-sm",children:t.hasProfile?"Has user profile":"No user profile"})]})]}),(0,r.jsxs)("div",{className:"bg-gray-50 p-4 rounded-md",children:[(0,r.jsx)("h3",{className:"font-medium text-gray-900 mb-2",children:"Registration Status"}),(0,r.jsxs)("div",{className:"flex items-center",children:[t.canRegister?(0,r.jsx)(o.Z,{className:"h-5 w-5 text-green-500 mr-2"}):(0,r.jsx)(c.Z,{className:"h-5 w-5 text-red-500 mr-2"}),(0,r.jsx)("span",{className:"text-sm",children:t.canRegister?"Can register":"Cannot register"})]})]})]})]}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)("button",{onClick:p,disabled:x,className:"w-full bg-blue-600 text-white py-3 px-4 rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center",children:x?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"loading-spinner w-4 h-4 mr-2"}),"Fixing Registration..."]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(d.Z,{className:"h-4 w-4 mr-2"}),"Fix Alen's Registration"]})}),(0,r.jsxs)("button",{onClick:()=>{let e="\nHi Alen,\n\nYour registration has been fixed! Please follow these steps:\n\n1. Go to: ".concat(window.location.origin,"/auth/register\n2. Use email: ").concat(g,'\n3. Create a password (at least 6 characters)\n4. Fill in your full name: Alen PS\n5. Choose a username\n6. Click "Register"\n\nYou should be able to register successfully now. If you still have issues, please contact the admin.\n\nBest regards,\nNBCC Admin Team\n    ').trim();navigator.clipboard.writeText(e).then(()=>{m.default.success("Instructions copied to clipboard! Send this to Alen.")}).catch(()=>{m.default.error("Could not copy to clipboard")})},className:"w-full bg-green-600 text-white py-3 px-4 rounded-md hover:bg-green-700 flex items-center justify-center",children:[(0,r.jsx)(u.Z,{className:"h-4 w-4 mr-2"}),"Copy Instructions for Alen"]}),(0,r.jsx)("button",{onClick:w,className:"w-full bg-gray-600 text-white py-2 px-4 rounded-md hover:bg-gray-700",children:"Refresh Status"})]}),(0,r.jsxs)("div",{className:"mt-6 p-4 bg-blue-50 rounded-md",children:[(0,r.jsx)("h3",{className:"font-medium text-blue-900 mb-2",children:"What this fix does:"}),(0,r.jsxs)("ul",{className:"text-sm text-blue-800 space-y-1",children:[(0,r.jsx)("li",{children:"• Ensures Alen is in the allowed_users list"}),(0,r.jsx)("li",{children:'• Resets any "used" status to allow fresh registration'}),(0,r.jsx)("li",{children:"• Cleans up any conflicting user profiles"}),(0,r.jsx)("li",{children:"• Enables manual verification bypass"}),(0,r.jsx)("li",{children:"• Tests registration eligibility"})]})]})]})})})})}}},function(e){e.O(0,[5285,4733,2888,9774,179],function(){return e(e.s=1971)}),_N_E=e.O()}]);