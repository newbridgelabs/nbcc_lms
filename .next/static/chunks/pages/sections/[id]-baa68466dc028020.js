(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5350],{8941:function(e,s,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/sections/[id]",function(){return t(1324)}])},5747:function(e,s,t){"use strict";t.d(s,{Z:function(){return i}});var r=t(5893),n=t(7294),a=t(4976),l=t(1707),c=t(2779);function i(e){let{pdfUrl:s,title:t}=e,[i,o]=(0,n.useState)(!0),[d,m]=(0,n.useState)(null),[x,u]=(0,n.useState)(0);(0,n.useEffect)(()=>{console.log("IframePDFViewer - PDF URL:",s),s&&(o(!0),m(null),u(e=>e+1))},[s]);let h=()=>{o(!0),m(null),u(e=>e+1)};return s?(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:[(0,r.jsx)("div",{className:"bg-gray-50 border-b border-gray-200 p-3 sm:p-4",children:(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 sm:gap-0",children:[(0,r.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,r.jsx)("h3",{className:"text-base sm:text-lg font-semibold text-gray-900 truncate",children:t}),(0,r.jsx)("p",{className:"text-xs sm:text-sm text-gray-600",children:"PDF Document"})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-2 flex-shrink-0",children:[(0,r.jsx)("button",{onClick:h,className:"p-2 text-gray-600 hover:text-gray-800 hover:bg-gray-200 rounded min-h-[44px] min-w-[44px] flex items-center justify-center",title:"Refresh PDF",children:(0,r.jsx)(a.Z,{className:"h-4 w-4"})}),(0,r.jsxs)("a",{href:s,target:"_blank",rel:"noopener noreferrer",className:"flex items-center px-2 sm:px-3 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 text-xs sm:text-sm min-h-[44px]",children:[(0,r.jsx)(l.Z,{className:"h-4 w-4 sm:mr-2"}),(0,r.jsx)("span",{className:"hidden sm:inline",children:"Open in New Tab"})]}),(0,r.jsxs)("a",{href:s,download:!0,className:"flex items-center px-2 sm:px-3 py-2 bg-gray-600 text-white rounded hover:bg-gray-700 text-xs sm:text-sm min-h-[44px]",children:[(0,r.jsx)(c.Z,{className:"h-4 w-4 sm:mr-2"}),(0,r.jsx)("span",{className:"hidden sm:inline",children:"Download"})]})]})]})}),i&&(0,r.jsx)("div",{className:"flex items-center justify-center h-96 bg-gray-50",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"loading-spinner mx-auto mb-4"}),(0,r.jsx)("p",{className:"text-gray-600",children:"Loading PDF document..."}),(0,r.jsxs)("p",{className:"text-xs text-gray-500 mt-2",children:["URL: ",s]})]})}),d&&(0,r.jsxs)("div",{className:"bg-red-50 border border-red-200 p-6 text-center",children:[(0,r.jsx)("p",{className:"text-red-600 mb-4",children:d}),(0,r.jsx)("div",{className:"space-y-4",children:(0,r.jsxs)("div",{className:"flex justify-center space-x-4",children:[(0,r.jsx)("button",{onClick:h,className:"px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700",children:"Try Again"}),(0,r.jsx)("a",{href:s,target:"_blank",rel:"noopener noreferrer",className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Open PDF Directly"})]})})]}),(0,r.jsxs)("div",{className:"relative pdf-viewer-container",children:[(0,r.jsx)("iframe",{src:s,width:"100%",height:"800",className:"border-0 ".concat(i?"opacity-0":"opacity-100"," transition-opacity duration-300 w-full"),title:t||"PDF Document",onLoad:()=>{console.log("IframePDFViewer - PDF loaded successfully"),o(!1),m(null)},onError:()=>{console.error("IframePDFViewer - Error loading PDF in iframe"),m("Failed to load PDF in iframe"),o(!1)},style:{minHeight:"60vh",height:"clamp(400px, 60vh, 800px)"}},x),i&&(0,r.jsx)("div",{className:"absolute inset-0 bg-gray-50 flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center p-4",children:[(0,r.jsx)("div",{className:"loading-spinner mx-auto mb-4"}),(0,r.jsx)("p",{className:"text-gray-600 text-sm sm:text-base",children:"Loading PDF..."})]})})]}),(0,r.jsx)("div",{className:"bg-gray-50 border-t border-gray-200 p-3",children:(0,r.jsxs)("p",{className:"text-xs text-gray-500 truncate",children:["Source: ",s]})})]}):(0,r.jsx)("div",{className:"bg-white rounded-lg shadow p-8 text-center",children:(0,r.jsx)("p",{className:"text-gray-500",children:"No PDF URL provided"})})}},7448:function(e,s,t){"use strict";t.d(s,{Z:function(){return i}});var r=t(5893),n=t(7294);let a=(0,t(3759).Z)("Volume2",[["polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5",key:"16drj5"}],["path",{d:"M15.54 8.46a5 5 0 0 1 0 7.07",key:"ltjumu"}],["path",{d:"M19.07 4.93a10 10 0 0 1 0 14.14",key:"1kegas"}]]);var l=t(1707),c=t(2779);function i(e){let{content:s}=e,[t,i]=(0,n.useState)(!1),o=()=>{let{html:e,plain_text:t}=s.content_data;return(0,r.jsx)("div",{className:"prose prose-lg max-w-none",children:e?(0,r.jsx)("div",{dangerouslySetInnerHTML:{__html:e}}):(0,r.jsx)("div",{className:"whitespace-pre-wrap",children:t})})},d=()=>{let{url:e,alt_text:t,caption:n,width:a,height:l}=s.content_data;return(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("img",{src:e,alt:t||s.title||"Image",className:"max-w-full h-auto rounded-lg shadow-lg mx-auto",style:{maxWidth:a?"".concat(a,"px"):"100%",maxHeight:l?"".concat(l,"px"):"auto"}}),n&&(0,r.jsx)("p",{className:"text-sm text-gray-600 mt-2 italic",children:n})]})},m=()=>{let{url:e,embed_url:t,thumbnail:n,duration:a,description:l}=s.content_data;if(e&&e.includes("youtube.com")){var c;let n=null===(c=e.match(/(?:youtube\.com\/watch\?v=|youtu\.be\/)([^&\n?#]+)/))||void 0===c?void 0:c[1];return(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)("div",{className:"relative aspect-video",children:(0,r.jsx)("iframe",{src:n?"https://www.youtube.com/embed/".concat(n):t,title:s.title||"Video",className:"w-full h-full rounded-lg",frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0})}),l&&(0,r.jsx)("p",{className:"text-sm text-gray-600",children:l}),a&&(0,r.jsxs)("p",{className:"text-xs text-gray-500",children:["Duration: ",a]})]})}return(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("video",{controls:!0,className:"w-full rounded-lg",poster:n,children:[(0,r.jsx)("source",{src:e,type:"video/mp4"}),"Your browser does not support the video tag."]}),l&&(0,r.jsx)("p",{className:"text-sm text-gray-600",children:l})]})},x=()=>{let{url:e,duration:t,transcript:n}=s.content_data;return(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,r.jsx)(a,{className:"h-6 w-6 text-gray-600"}),(0,r.jsx)("div",{className:"flex-1",children:(0,r.jsxs)("audio",{controls:!0,className:"w-full",children:[(0,r.jsx)("source",{src:e,type:"audio/mpeg"}),"Your browser does not support the audio element."]})})]}),t&&(0,r.jsxs)("p",{className:"text-xs text-gray-500 mt-2",children:["Duration: ",t]})]}),n&&(0,r.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,r.jsx)("h4",{className:"font-medium text-gray-900 mb-2",children:"Transcript"}),(0,r.jsx)("p",{className:"text-sm text-gray-700 whitespace-pre-wrap",children:n})]})]})},u=()=>{let{url:e,filename:t,page_count:n}=s.content_data;return(0,r.jsxs)("div",{className:"border border-gray-200 rounded-lg p-6 bg-gray-50",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h4",{className:"font-medium text-gray-900",children:t||"PDF Document"}),n&&(0,r.jsxs)("p",{className:"text-sm text-gray-600",children:[n," pages"]})]}),(0,r.jsxs)("div",{className:"flex space-x-2",children:[(0,r.jsxs)("a",{href:e,target:"_blank",rel:"noopener noreferrer",className:"flex items-center px-3 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:[(0,r.jsx)(l.Z,{className:"h-4 w-4 mr-2"}),"View"]}),(0,r.jsxs)("a",{href:e,download:t,className:"flex items-center px-3 py-2 bg-gray-600 text-white rounded hover:bg-gray-700",children:[(0,r.jsx)(c.Z,{className:"h-4 w-4 mr-2"}),"Download"]})]})]}),(0,r.jsx)("div",{className:"mt-4",children:(0,r.jsx)("iframe",{src:e,className:"w-full h-96 border border-gray-300 rounded",title:t||"PDF Document"})})]})},h=()=>{let{embed_code:e,source:t,url:n}=s.content_data;return(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)("div",{className:"embed-container",dangerouslySetInnerHTML:{__html:e}}),t&&(0,r.jsxs)("p",{className:"text-xs text-gray-500",children:["Source: ",t]}),n&&(0,r.jsx)("a",{href:n,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline text-sm",children:"View original"})]})};return(0,r.jsxs)("div",{className:"multimedia-content-item mb-8",children:[s.title&&(0,r.jsx)("h3",{className:"text-xl font-semibold text-gray-900 mb-4",children:s.title}),(0,r.jsx)("div",{className:"content-body",children:(()=>{switch(s.content_type){case"text":return o();case"image":return d();case"video":return m();case"audio":return x();case"pdf":return u();case"embed":return h();default:return(0,r.jsxs)("div",{className:"text-gray-500",children:["Unsupported content type: ",s.content_type]})}})()})]})}},1258:function(e,s,t){"use strict";t.d(s,{Z:function(){return r}});let r=(0,t(3759).Z)("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]])},4307:function(e,s,t){"use strict";t.d(s,{Z:function(){return r}});let r=(0,t(3759).Z)("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]])},2779:function(e,s,t){"use strict";t.d(s,{Z:function(){return r}});let r=(0,t(3759).Z)("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]])},1324:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return g}});var r=t(5893),n=t(7294),a=t(1163),l=t(4733),c=t(5747),i=t(7448),o=t(4563),d=t(1046),m=t(7298),x=t(1258),u=t(493),h=t(4307),p=t(6501);function g(){let[e,s]=(0,n.useState)(null),[t,g]=(0,n.useState)([]),[f,j]=(0,n.useState)(null),[y,b]=(0,n.useState)(null),[N,v]=(0,n.useState)([]),[w,_]=(0,n.useState)([]),[k,S]=(0,n.useState)(!0),[D,Z]=(0,n.useState)(!1),F=(0,a.useRouter)(),{id:P}=F.query;(0,n.useEffect)(()=>{P&&C()},[P]);let C=async()=>{try{let e=await (0,d.ts)();if(!e){F.push("/auth/login");return}s(e);let{sections:t,error:r}=await (0,m.t7)(d.OQ);if(r)throw r;g(t||[]);let n=parseInt(P),a=null==t?void 0:t.find(e=>e.section_number===n);if(!a){p.default.error("Section not found"),F.push("/dashboard");return}if(j(a),a.file_path){console.log("Section found:",a),console.log("File path:",a.file_path);let e=await (0,m.KO)(a.file_path,d.OQ);console.log("Generated URL:",e),b(e)}else console.log("No file_path found for section:",a);try{let e=await fetch("/api/admin/multimedia-content?section_id=".concat(a.id)),s=await e.json();e.ok?v(s.content||[]):(console.log("Multimedia content not available yet:",s.error),v([]))}catch(e){console.log("Multimedia content not available:",e),v([])}let{progress:l,error:c}=await (0,m.L$)(e.id,d.OQ);c?console.error("Error loading progress:",c):_(l||[])}catch(e){console.error("Error loading section:",e),p.default.error("Failed to load section")}finally{S(!1)}},E=async()=>{if(!e||!f){p.default.error("User or section not found");return}Z(!0);try{console.log("Attempting to complete section:",{userId:e.id,sectionId:f.id,sectionNumber:f.section_number});let{data:s,error:r}=await (0,m.zy)(e.id,f.id,d.OQ);if(r)throw console.error("Section completion error:",r),Error(r.message||"Failed to mark section as complete");console.log("Section completed successfully:",s),p.default.success("Section completed!");try{let{progress:s,error:t}=await (0,m.L$)(e.id,d.OQ);t?console.error("Error reloading progress:",t):(_(s||[]),console.log("Progress updated after completion:",s),console.log("Updated progress details:",null==s?void 0:s.map(e=>{var s;return{sectionId:e.section_id,sectionNumber:null===(s=e.pdf_sections)||void 0===s?void 0:s.section_number,completed:e.completed}})))}catch(e){console.error("Failed to reload progress:",e)}setTimeout(()=>{let e=f.section_number+1,s=t.find(s=>s.section_number===e);console.log("Navigation decision:",{currentSectionNumber:f.section_number,nextSectionNumber:e,nextSectionExists:!!s,totalSections:t.length}),s?(console.log("Navigating to next section:",e),F.push("/sections/".concat(e))):(console.log("All sections completed, navigating to agreement"),F.push("/agreement"))},1e3)}catch(e){console.error("Error completing section:",e),p.default.error(e.message||"Failed to complete section")}finally{Z(!1)}},L=()=>!!f&&!!w&&w.some(e=>e.section_id===f.id&&e.completed),I=()=>w.filter(e=>e.completed&&e.pdf_sections).map(e=>e.pdf_sections.section_number);return k?(0,r.jsx)(l.Z,{requireAuth:!0,children:(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,r.jsx)("div",{className:"loading-spinner"})})}):f?(()=>{if(!f||!t)return!1;if(1===f.section_number)return!0;let e=f.section_number-1;return I().includes(e)})()?(0,r.jsx)(l.Z,{requireAuth:!0,children:(0,r.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,r.jsx)("div",{className:"bg-white shadow",children:(0,r.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 sm:py-6",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center min-w-0 flex-1",children:[(0,r.jsx)("button",{onClick:()=>F.push("/dashboard"),className:"mr-3 sm:mr-4 p-2 text-gray-400 hover:text-gray-600 flex-shrink-0",children:(0,r.jsx)(x.Z,{className:"h-5 w-5 sm:h-6 sm:w-6"})}),(0,r.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,r.jsx)("h1",{className:"text-lg sm:text-xl lg:text-2xl font-bold text-gray-900 truncate",children:f.title}),(0,r.jsxs)("p",{className:"text-xs sm:text-sm text-gray-500",children:["Section ",f.section_number," of ",t.length]})]})]}),L()&&(0,r.jsxs)("div",{className:"flex items-center text-green-600",children:[(0,r.jsx)(u.Z,{className:"h-5 w-5 mr-2"}),(0,r.jsx)("span",{className:"text-sm font-medium",children:"Completed"})]})]})})}),(0,r.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 sm:py-8",children:(0,r.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-4 sm:gap-8",children:[(0,r.jsxs)("div",{className:"lg:col-span-3",children:[(0,r.jsxs)("div",{className:"space-y-6",children:[N.length>0&&(0,r.jsx)("div",{className:"bg-white rounded-lg shadow p-6",children:(0,r.jsx)("div",{className:"space-y-8",children:N.map(e=>(0,r.jsx)(i.Z,{content:e},e.id))})}),y&&(0,r.jsx)(c.Z,{pdfUrl:y,title:f.title}),!y&&0===N.length&&(0,r.jsx)("div",{className:"bg-white rounded-lg shadow p-8 text-center",children:(0,r.jsx)("p",{className:"text-gray-500",children:"No content is available for this section yet."})}),(y||N.length>0)&&!L()&&(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow p-6 text-center",children:[(0,r.jsx)("button",{onClick:E,disabled:D,className:"px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 font-medium disabled:opacity-50 disabled:cursor-not-allowed",children:D?"Completing...":"Mark Section as Complete"}),(0,r.jsx)("p",{className:"text-sm text-gray-600 mt-2",children:"Click to proceed to the next section"})]})]}),(0,r.jsxs)("div",{className:"mt-8 flex flex-col sm:flex-row justify-between gap-3 sm:gap-0 section-navigation",children:[(0,r.jsxs)("button",{onClick:()=>{let e=f.section_number-1;e>=1?F.push("/sections/".concat(e)):F.push("/dashboard")},className:"flex items-center justify-center px-4 py-3 sm:py-2 border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50 min-h-[44px] transition-colors duration-200",children:[(0,r.jsx)(x.Z,{className:"h-4 w-4 mr-2 flex-shrink-0"}),(0,r.jsx)("span",{className:"truncate",children:f.section_number>1?"Previous Section":"Dashboard"})]}),(0,r.jsxs)("button",{onClick:()=>{let e=f.section_number+1;t.find(s=>s.section_number===e)?F.push("/sections/".concat(e)):F.push("/agreement")},disabled:!L(),className:"flex items-center justify-center px-4 py-3 sm:py-2 bg-church-primary text-white rounded-md hover:bg-church-secondary disabled:opacity-50 disabled:cursor-not-allowed min-h-[44px] transition-colors duration-200",children:[(0,r.jsx)("span",{className:"truncate",children:f.section_number<t.length?"Next Section":"Agreement"}),(0,r.jsx)(h.Z,{className:"h-4 w-4 ml-2 flex-shrink-0"})]})]})]}),(0,r.jsx)("div",{className:"lg:col-span-1",children:(0,r.jsx)(o.Z,{sections:t,currentSection:f.section_number,completedSections:I(),onSectionClick:e=>{"agreement"===e?F.push("/agreement"):F.push("/sections/".concat(e))}})})]})})]})}):(0,r.jsx)(l.Z,{requireAuth:!0,children:(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Section Locked"}),(0,r.jsx)("p",{className:"text-gray-600 mb-6",children:"You need to complete the previous sections before accessing this one."}),(0,r.jsx)("button",{onClick:()=>F.push("/dashboard"),className:"px-4 py-2 bg-church-primary text-white rounded hover:bg-church-secondary",children:"Return to Dashboard"})]})})}):(0,r.jsx)(l.Z,{requireAuth:!0,children:(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Section Not Found"}),(0,r.jsx)("button",{onClick:()=>F.push("/dashboard"),className:"px-4 py-2 bg-church-primary text-white rounded hover:bg-church-secondary",children:"Return to Dashboard"})]})})})}}},function(e){e.O(0,[5285,9495,4733,8522,2888,9774,179],function(){return e(e.s=8941)}),_N_E=e.O()}]);