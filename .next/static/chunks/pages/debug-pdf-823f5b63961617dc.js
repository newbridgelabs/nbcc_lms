(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4201],{8737:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/debug-pdf",function(){return s(1864)}])},7298:function(e,t,s){"use strict";s.d(t,{KO:function(){return i},L$:function(){return c},oN:function(){return o},sN:function(){return n},t7:function(){return l},zy:function(){return a}});var r=s(9495);let n=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5;try{let s=await e.arrayBuffer(),n=await r.PDFDocument.load(s),o=n.getPageCount(),l=Math.ceil(o/t),i=[];for(let e=0;e<t;e++){let t=e*l,s=Math.min(t+l-1,o-1);if(t<o){let o=await r.PDFDocument.create();for(let e=t;e<=s;e++){let[t]=await o.copyPages(n,[e]);o.addPage(t)}let l=await o.save();i.push({sectionNumber:e+1,title:"Section ".concat(e+1," (Pages ").concat(t+1,"-").concat(s+1,")"),content:l,pageRange:"".concat(t+1,"-").concat(s+1),totalPages:s-t+1})}}return{sections:i,error:null}}catch(e){return console.error("Error splitting PDF:",e),{sections:null,error:e}}},o=async(e,t)=>{try{console.log("Starting PDF sections upload...");let{data:{session:s}}=await t.auth.getSession();if(!(null==s?void 0:s.access_token))throw Error("No authentication token available");console.log("Session token available, preparing upload...");let r={sections:e.map(t=>({title:t.title,section_number:t.sectionNumber,total_sections:e.length,content:Array.from(new Uint8Array(t.content))}))};console.log("Sending request to upload API...");let n=await fetch("/api/admin/upload-sections",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(s.access_token)},body:JSON.stringify(r)});if(console.log("Upload API response status:",n.status),!n.ok){let e="Failed to upload sections";try{let t=await n.json();e=t.error||e,console.error("Upload API error:",t)}catch(s){let t=await n.text();console.error("Upload API returned non-JSON response:",t),e=t.includes("<html>")||t.includes("<!DOCTYPE")?"Server returned HTML instead of JSON. Check server logs for authentication issues.":"Server error: ".concat(n.status," ").concat(n.statusText)}throw Error(e)}let o=await n.json();return console.log("Upload successful:",o),{sections:o.sections,error:null}}catch(e){return console.error("Error uploading sections:",e),{sections:null,error:e}}},l=async e=>{try{if(!e)return{sections:[],error:null};let{data:t,error:s}=await e.from("pdf_sections").select("*").order("section_number");if(s)throw s;return{sections:t,error:null}}catch(e){return{sections:null,error:e}}},i=async(e,t)=>{try{if(console.log("Getting PDF URL for file path:",e),!e)return console.error("No file path provided"),null;let{data:s}=t.storage.from("pdf-sections").getPublicUrl(e);if(console.log("Generated public URL:",null==s?void 0:s.publicUrl),null==s?void 0:s.publicUrl)return console.log("Returning public URL:",s.publicUrl),s.publicUrl;return null}catch(e){return console.error("Error getting PDF URL:",e),null}},a=async(e,t,s)=>{try{if(console.log("Marking section complete:",{userId:e,sectionId:t}),!e||!t)throw Error("User ID and Section ID are required");let s=await fetch("/api/complete-section",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:e,sectionId:t})}),r=await s.json();if(!s.ok)throw Error(r.error||"Failed to complete section");return console.log("Section marked complete successfully:",r.data),{data:r.data,error:null}}catch(e){return console.error("Error marking section complete:",e),{data:null,error:e}}},c=async(e,t)=>{try{if(!t||!e)return{progress:[],error:null};console.log("Getting user progress for userId:",e);let{data:s,error:r}=await t.from("user_progress").select("\n        *,\n        pdf_sections (\n          id,\n          title,\n          section_number,\n          total_sections\n        )\n      ").eq("user_id",e);if(r)throw console.error("Error fetching user progress:",r),r;console.log("Raw progress data:",s);let n=(null==s?void 0:s.filter(e=>null!==e.pdf_sections))||[];return console.log("Valid progress data:",n),{progress:n,error:null}}catch(e){return console.error("getUserProgress error:",e),{progress:null,error:e}}}},1864:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return a}});var r=s(5893),n=s(7294),o=s(4733),l=s(1046),i=s(7298);function a(){let[e,t]=(0,n.useState)([]),[s,a]=(0,n.useState)(null),[c,d]=(0,n.useState)(null),[u,h]=(0,n.useState)(null),[g,m]=(0,n.useState)(!0),[x,f]=(0,n.useState)(null);(0,n.useEffect)(()=>{p()},[]);let p=async()=>{try{console.log("Loading sections for debug...");let{sections:e,error:s}=await (0,i.t7)(l.OQ);if(s)throw s;console.log("Loaded sections:",e),t(e||[]),e&&e.length>0&&await b(e[0])}catch(e){console.error("Error loading sections:",e),f(e.message)}finally{m(!1)}},b=async e=>{try{if(console.log("Selecting section:",e),a(e),d(null),h(null),e.file_path){console.log("Getting PDF URL for:",e.file_path);let t=await (0,i.KO)(e.file_path,l.OQ);console.log("Generated PDF URL:",t),d(t),t&&j(t)}else console.log("No file_path for section:",e)}catch(e){console.error("Error selecting section:",e),f(e.message)}},j=async e=>{try{console.log("Testing URL accessibility:",e);let t=await fetch(e,{method:"HEAD"});console.log("URL test response:",t.status,t.statusText),h({status:t.status,statusText:t.statusText,ok:t.ok,headers:Object.fromEntries(t.headers.entries())})}catch(e){console.error("URL test failed:",e),h({error:e.message,ok:!1})}};return g?(0,r.jsx)(o.Z,{children:(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"loading-spinner mx-auto mb-4"}),(0,r.jsx)("p",{className:"text-gray-600",children:"Loading debug info..."})]})})}):(0,r.jsx)(o.Z,{children:(0,r.jsx)("div",{className:"min-h-screen bg-gray-50",children:(0,r.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,r.jsxs)("div",{className:"mb-8",children:[(0,r.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"PDF Debug Page"}),(0,r.jsx)("p",{className:"mt-2 text-gray-600",children:"Debug PDF loading and accessibility"})]}),x&&(0,r.jsx)("div",{className:"mb-6 bg-red-50 border border-red-200 rounded-md p-4",children:(0,r.jsxs)("p",{className:"text-red-600",children:["Error: ",x]})}),(0,r.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[(0,r.jsx)("div",{children:(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold mb-4",children:"Available Sections"}),0===e.length?(0,r.jsx)("p",{className:"text-gray-500",children:"No sections found. Upload some PDFs first."}):(0,r.jsx)("div",{className:"space-y-2",children:e.map(e=>(0,r.jsxs)("button",{onClick:()=>b(e),className:"w-full text-left p-3 rounded-md border ".concat((null==s?void 0:s.id)===e.id?"border-blue-500 bg-blue-50":"border-gray-200 hover:bg-gray-50"),children:[(0,r.jsx)("div",{className:"font-medium",children:e.title}),(0,r.jsxs)("div",{className:"text-sm text-gray-500",children:["Section ",e.section_number," of ",e.total_sections]}),(0,r.jsxs)("div",{className:"text-xs text-gray-400 mt-1",children:["File: ",e.file_path||"No file"]})]},e.id))})]})}),(0,r.jsx)("div",{children:s&&(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"Section Info"}),(0,r.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("strong",{children:"Title:"})," ",s.title]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("strong",{children:"Section:"})," ",s.section_number," of ",s.total_sections]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("strong",{children:"File Path:"})," ",s.file_path||"None"]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("strong",{children:"Created:"})," ",new Date(s.created_at).toLocaleString()]})]})]}),c&&(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"Generated URL"}),(0,r.jsx)("div",{className:"space-y-2 text-sm",children:(0,r.jsxs)("div",{className:"break-all",children:[(0,r.jsx)("strong",{children:"URL:"}),(0,r.jsx)("a",{href:c,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline ml-2",children:c})]})})]}),u&&(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"URL Accessibility Test"}),(0,r.jsx)("div",{className:"space-y-2 text-sm",children:u.error?(0,r.jsxs)("div",{className:"text-red-600",children:[(0,r.jsx)("strong",{children:"Error:"})," ",u.error]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:u.ok?"text-green-600":"text-red-600",children:[(0,r.jsx)("strong",{children:"Status:"})," ",u.status," ",u.statusText]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("strong",{children:"Accessible:"})," ",u.ok?"Yes":"No"]}),u.headers&&(0,r.jsxs)("div",{children:[(0,r.jsx)("strong",{children:"Content-Type:"})," ",u.headers["content-type"]||"Not specified"]})]})})]}),c&&(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"Iframe Test"}),(0,r.jsx)("iframe",{src:c,width:"100%",height:"400",className:"border border-gray-300 rounded",title:s.title})]})]})})]})]})})})}}},function(e){e.O(0,[5285,9495,4733,2888,9774,179],function(){return e(e.s=8737)}),_N_E=e.O()}]);