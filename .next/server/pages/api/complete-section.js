"use strict";(()=>{var e={};e.id=7173,e.ids=[7173],e.modules={2885:e=>{e.exports=require("@supabase/supabase-js")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6249:(e,r)=>{Object.defineProperty(r,"l",{enumerable:!0,get:function(){return function e(r,t){return t in r?r[t]:"then"in r&&"function"==typeof r.then?r.then(r=>e(r,t)):"function"==typeof r&&"default"===t?r:void 0}}})},5702:(e,r,t)=>{t.r(r),t.d(r,{config:()=>d,default:()=>l,routeModule:()=>u});var o={};t.r(o),t.d(o,{default:()=>c});var s=t(1802),n=t(7153),i=t(6249);let a=(0,t(2885).createClient)("https://qyhdzjzvkggcsuhnenaz.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY);async function c(e,r){if("POST"!==e.method)return r.status(405).json({error:"Method not allowed"});try{let t;let{userId:o,sectionId:s}=e.body;if(console.log("Completing section:",{userId:o,sectionId:s}),!o||!s)return r.status(400).json({error:"User ID and Section ID are required"});let{data:n,error:i}=await a.from("pdf_sections").select("*").eq("id",s).single();if(i)return console.error("Section lookup error:",i),r.status(400).json({error:"Section not found"});let{data:c,error:l}=await a.from("user_progress").select("*").eq("user_id",o).eq("section_id",s).single();if(c){let{data:e,error:r}=await a.from("user_progress").update({completed:!0,completed_at:new Date().toISOString()}).eq("user_id",o).eq("section_id",s).select();if(r)throw console.error("Update error:",r),r;t=e}else{let{data:e,error:r}=await a.from("user_progress").insert({user_id:o,section_id:s,completed:!0,completed_at:new Date().toISOString()}).select();if(r)throw console.error("Insert error:",r),r;t=e}console.log("Section completed successfully:",t);let{data:d,error:u}=await a.from("pdf_sections").select("*").eq("id",s).single();console.log("Section check:",d),console.log("Section check error:",u);let{data:p,error:f}=await a.from("user_progress").select(`
        *,
        pdf_sections (
          id,
          title,
          section_number,
          total_sections
        )
      `).eq("user_id",o);return f&&console.error("Error fetching updated progress:",f),console.log("Updated progress after completion:",p),console.log("Progress query error:",f),r.status(200).json({success:!0,data:t,updatedProgress:p})}catch(e){return console.error("Section completion error:",e),r.status(500).json({error:"Failed to complete section",details:e.message})}}let l=(0,i.l)(o,"default"),d=(0,i.l)(o,"config"),u=new s.PagesAPIRouteModule({definition:{kind:n.x.PAGES_API,page:"/api/complete-section",pathname:"/api/complete-section",bundlePath:"",filename:""},userland:o})},7153:(e,r)=>{var t;Object.defineProperty(r,"x",{enumerable:!0,get:function(){return t}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(t||(t={}))},1802:(e,r,t)=>{e.exports=t(145)}};var r=require("../../webpack-api-runtime.js");r.C(e);var t=r(r.s=5702);module.exports=t})();