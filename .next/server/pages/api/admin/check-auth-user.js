"use strict";(()=>{var e={};e.id=6207,e.ids=[6207],e.modules={2885:e=>{e.exports=require("@supabase/supabase-js")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6201:e=>{e.exports=import("react-hot-toast")},6249:(e,r)=>{Object.defineProperty(r,"l",{enumerable:!0,get:function(){return function e(r,o){return o in r?r[o]:"then"in r&&"function"==typeof r.then?r.then(r=>e(r,o)):"function"==typeof r&&"default"===o?r:void 0}}})},4967:(e,r,o)=>{o.r(r),o.d(r,{config:()=>d,default:()=>c,routeModule:()=>m});var t={};o.r(t),o.d(t,{default:()=>u});var s=o(1802),n=o(7153),a=o(6249),i=o(2885),l=o(8915);async function u(e,r){if("POST"!==e.method)return r.status(405).json({error:"Method not allowed"});try{let{user:o,error:t}=await (0,l.su)(e);if(t||!o)return r.status(401).json({error:t||"Unauthorized"});let{email:s}=e.body;if(!s)return r.status(400).json({error:"Email is required"});let n=(0,i.createClient)("https://qyhdzjzvkggcsuhnenaz.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY,{auth:{autoRefreshToken:!1,persistSession:!1}}),{data:a,error:u}=await n.auth.admin.listUsers();if(u)return console.error("Error listing users:",u),r.status(500).json({error:`Failed to check user existence: ${u.message}`,exists:!1});let c=a.users.some(e=>e.email?.toLowerCase()===s.toLowerCase());return r.status(200).json({success:!0,exists:c,email:s.toLowerCase()})}catch(e){return console.error("Error in check-auth-user:",e),r.status(500).json({error:"Internal server error",exists:!1})}}let c=(0,a.l)(t,"default"),d=(0,a.l)(t,"config"),m=new s.PagesAPIRouteModule({definition:{kind:n.x.PAGES_API,page:"/api/admin/check-auth-user",pathname:"/api/admin/check-auth-user",bundlePath:"",filename:""},userland:t})},8915:(e,r,o)=>{o.d(r,{Cn:()=>n,su:()=>a});var t=o(8456);let s=["admin@nbcc.com","pastor@nbcc.com","mppaul1458@gmail.com"],n=async(e,r)=>{try{let{data:o,error:n}=await t.OQ.from("users").select("is_admin, role").eq("id",e).single();if(!n&&o&&(!0===o.is_admin||"admin"===o.role))return!0;let a=s.includes(r.toLowerCase())||r.toLowerCase().includes("admin")||r.toLowerCase().includes("pastor");if(a&&e)try{await t.OQ.from("users").upsert({id:e,email:r,is_admin:!0,role:"admin"},{onConflict:"id",ignoreDuplicates:!1}),console.log("Updated admin status in database for:",r)}catch(e){console.warn("Could not update admin status in database:",e.message)}return a}catch(e){return console.warn("Admin status check failed:",e.message),s.includes(r.toLowerCase())||r.toLowerCase().includes("admin")||r.toLowerCase().includes("pastor")}},a=async e=>{try{console.log("Checking admin access for API route");let r=e.headers.authorization;if(console.log("Auth header present:",!!r),!r||!r.startsWith("Bearer "))return console.log("No valid authorization header found"),{user:null,error:"No authorization token provided"};let t=r.split(" ")[1];console.log("Token extracted, length:",t?.length);let{createClient:s}=await Promise.resolve().then(o.t.bind(o,2885,23)),a=s("https://qyhdzjzvkggcsuhnenaz.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY);console.log("Verifying JWT token...");let{data:{user:i},error:l}=await a.auth.getUser(t);if(l)return console.log("Token verification failed:",l.message),{user:null,error:`Invalid or expired token: ${l.message}`};if(!i)return console.log("No user found from token"),{user:null,error:"Invalid or expired token"};console.log("User verified:",i.email);let u=await n(i.id,i.email);if(console.log("Admin status:",u),!u)return console.log("User does not have admin privileges"),{user:null,error:"Admin privileges required"};return console.log("Admin access granted"),{user:i,error:null}}catch(e){return console.error("API admin access check failed:",e),{user:null,error:`Authentication failed: ${e.message}`}}}},8456:(e,r,o)=>{o.d(r,{OQ:()=>a});var t=o(2885);let s="https://qyhdzjzvkggcsuhnenaz.supabase.co",n="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InF5aGR6anp2a2dnY3N1aG5lbmF6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk0NjY1NzgsImV4cCI6MjA2NTA0MjU3OH0.wauN1JdrKCl82WFuwtCfq0oZVob8UEE71wjJw6otCFY";console.log("\uD83D\uDD0D Supabase Debug Info:"),console.log("URL:",s),console.log("Key exists:",!!n),console.log("Key length:",n?.length),console.log("âœ… Is Supabase configured:",!!(s&&n&&s.includes("supabase.co")&&n.length>50));let a=s&&n?(0,t.createClient)(s,n):null;console.log("\uD83D\uDE80 Supabase client created:",!!a)},7153:(e,r)=>{var o;Object.defineProperty(r,"x",{enumerable:!0,get:function(){return o}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(o||(o={}))},1802:(e,r,o)=>{e.exports=o(145)}};var r=require("../../../webpack-api-runtime.js");r.C(e);var o=r(r.s=4967);module.exports=o})();