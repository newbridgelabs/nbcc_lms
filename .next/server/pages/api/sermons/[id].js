"use strict";(()=>{var e={};e.id=1440,e.ids=[1440],e.modules={2885:e=>{e.exports=require("@supabase/supabase-js")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6201:e=>{e.exports=import("react-hot-toast")},6249:(e,r)=>{Object.defineProperty(r,"l",{enumerable:!0,get:function(){return function e(r,t){return t in r?r[t]:"then"in r&&"function"==typeof r.then?r.then(r=>e(r,t)):"function"==typeof r&&"default"===t?r:void 0}}})},4043:(e,r,t)=>{t.r(r),t.d(r,{config:()=>f,default:()=>m,routeModule:()=>p});var s={};t.r(s),t.d(s,{default:()=>c});var o=t(1802),n=t(7153),i=t(6249),a=t(2885),l=t(8915);let u=process.env.SUPABASE_SERVICE_ROLE_KEY,d=(0,a.createClient)("https://qyhdzjzvkggcsuhnenaz.supabase.co",u);async function c(e,r){try{let t=e.headers.authorization,s=e.cookies["sb-access-token"]||e.cookies["supabase-auth-token"],o=null;if(t&&t.startsWith("Bearer ")){let e=t.substring(7),{data:{user:r},error:s}=await d.auth.getUser(e);s||(o=r)}else if(s){let{data:{user:e},error:r}=await d.auth.getUser(s);r||(o=e)}let{id:n}=e.query;if("GET"===e.method){let{data:e,error:t}=await d.from("sermons").select(`
          *,
          sermon_questions (
            id,
            question_text,
            question_order,
            is_private,
            placeholder_text
          )
        `).eq("id",n).eq("is_active",!0).order("question_order",{foreignTable:"sermon_questions",ascending:!0}).single();if(t){if("PGRST116"===t.code)return r.status(404).json({error:"Sermon not found"});throw t}return r.status(200).json({sermon:e})}if("PUT"===e.method){if(!o)return r.status(401).json({error:"Authentication required"});if(!await (0,l.Cn)(o.id,o.email))return r.status(403).json({error:"Admin access required"});let{title:t,description:s,sermon_date:i,pastor_name:a,scripture_reference:u,is_active:c,questions:m}=e.body;if(!t?.trim())return r.status(400).json({error:"Title is required"});if(!i)return r.status(400).json({error:"Sermon date is required"});if(!m||0===m.length)return r.status(400).json({error:"At least one question is required"});let{data:f,error:p}=await d.from("sermons").update({title:t.trim(),description:s?.trim()||null,sermon_date:i,pastor_name:a?.trim()||null,scripture_reference:u?.trim()||null,is_active:!1!==c}).eq("id",n).select().single();if(p)throw p;let{error:g}=await d.from("sermon_questions").delete().eq("sermon_id",n);if(g)throw g;let h=m.map((e,r)=>({sermon_id:n,question_text:e.question_text.trim(),question_order:r+1,is_private:!1!==e.is_private,placeholder_text:e.placeholder_text?.trim()||null})),{data:_,error:w}=await d.from("sermon_questions").insert(h).select();if(w)throw w;return r.status(200).json({sermon:f,questions:_})}if("DELETE"===e.method){if(!o)return r.status(401).json({error:"Authentication required"});if(!await (0,l.Cn)(o.id,o.email))return r.status(403).json({error:"Admin access required"});let{error:e}=await d.from("sermons").delete().eq("id",n);if(e)throw e;return r.status(200).json({message:"Sermon deleted successfully"})}return r.status(405).json({error:"Method not allowed"})}catch(e){return console.error("Sermon API error:",e),r.status(500).json({error:e.message||"Internal server error"})}}let m=(0,i.l)(s,"default"),f=(0,i.l)(s,"config"),p=new o.PagesAPIRouteModule({definition:{kind:n.x.PAGES_API,page:"/api/sermons/[id]",pathname:"/api/sermons/[id]",bundlePath:"",filename:""},userland:s})},8915:(e,r,t)=>{t.d(r,{Cn:()=>n,su:()=>i});var s=t(8456);let o=["admin@nbcc.com","pastor@nbcc.com","mppaul1458@gmail.com"],n=async(e,r)=>{try{let{data:t,error:n}=await s.OQ.from("users").select("is_admin, role").eq("id",e).single();if(!n&&t&&(!0===t.is_admin||"admin"===t.role))return!0;let i=o.includes(r.toLowerCase())||r.toLowerCase().includes("admin")||r.toLowerCase().includes("pastor");if(i&&e)try{await s.OQ.from("users").upsert({id:e,email:r,is_admin:!0,role:"admin"},{onConflict:"id",ignoreDuplicates:!1}),console.log("Updated admin status in database for:",r)}catch(e){console.warn("Could not update admin status in database:",e.message)}return i}catch(e){return console.warn("Admin status check failed:",e.message),o.includes(r.toLowerCase())||r.toLowerCase().includes("admin")||r.toLowerCase().includes("pastor")}},i=async e=>{try{console.log("Checking admin access for API route");let r=e.headers.authorization;if(console.log("Auth header present:",!!r),!r||!r.startsWith("Bearer "))return console.log("No valid authorization header found"),{user:null,error:"No authorization token provided"};let s=r.split(" ")[1];console.log("Token extracted, length:",s?.length);let{createClient:o}=await Promise.resolve().then(t.t.bind(t,2885,23)),i=o("https://qyhdzjzvkggcsuhnenaz.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY);console.log("Verifying JWT token...");let{data:{user:a},error:l}=await i.auth.getUser(s);if(l)return console.log("Token verification failed:",l.message),{user:null,error:`Invalid or expired token: ${l.message}`};if(!a)return console.log("No user found from token"),{user:null,error:"Invalid or expired token"};console.log("User verified:",a.email);let u=await n(a.id,a.email);if(console.log("Admin status:",u),!u)return console.log("User does not have admin privileges"),{user:null,error:"Admin privileges required"};return console.log("Admin access granted"),{user:a,error:null}}catch(e){return console.error("API admin access check failed:",e),{user:null,error:`Authentication failed: ${e.message}`}}}},8456:(e,r,t)=>{t.d(r,{OQ:()=>i});var s=t(2885);let o="https://qyhdzjzvkggcsuhnenaz.supabase.co",n="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InF5aGR6anp2a2dnY3N1aG5lbmF6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk0NjY1NzgsImV4cCI6MjA2NTA0MjU3OH0.wauN1JdrKCl82WFuwtCfq0oZVob8UEE71wjJw6otCFY";console.log("\uD83D\uDD0D Supabase Debug Info:"),console.log("URL:",o),console.log("Key exists:",!!n),console.log("Key length:",n?.length),console.log("âœ… Is Supabase configured:",!!(o&&n&&o.includes("supabase.co")&&n.length>50));let i=o&&n?(0,s.createClient)(o,n):null;console.log("\uD83D\uDE80 Supabase client created:",!!i)},7153:(e,r)=>{var t;Object.defineProperty(r,"x",{enumerable:!0,get:function(){return t}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(t||(t={}))},1802:(e,r,t)=>{e.exports=t(145)}};var r=require("../../../webpack-api-runtime.js");r.C(e);var t=r(r.s=4043);module.exports=t})();