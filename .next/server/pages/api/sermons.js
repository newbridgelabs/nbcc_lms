"use strict";(()=>{var e={};e.id=1806,e.ids=[1806],e.modules={2885:e=>{e.exports=require("@supabase/supabase-js")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6201:e=>{e.exports=import("react-hot-toast")},6249:(e,r)=>{Object.defineProperty(r,"l",{enumerable:!0,get:function(){return function e(r,t){return t in r?r[t]:"then"in r&&"function"==typeof r.then?r.then(r=>e(r,t)):"function"==typeof r&&"default"===t?r:void 0}}})},2789:(e,r,t)=>{t.r(r),t.d(r,{config:()=>g,default:()=>m,routeModule:()=>p});var o={};t.r(o),t.d(o,{default:()=>c});var s=t(1802),n=t(7153),a=t(6249),i=t(2885),l=t(8915);let u=process.env.SUPABASE_SERVICE_ROLE_KEY,d=(0,i.createClient)("https://qyhdzjzvkggcsuhnenaz.supabase.co",u);async function c(e,r){try{let t=e.headers.authorization,o=e.cookies["sb-access-token"]||e.cookies["supabase-auth-token"],s=null;if(t&&t.startsWith("Bearer ")){let e=t.substring(7),{data:{user:r},error:o}=await d.auth.getUser(e);o||(s=r)}else if(o){let{data:{user:e},error:r}=await d.auth.getUser(o);r||(s=e)}if("GET"===e.method){let{data:e,error:t}=await d.from("sermons").select(`
          *,
          sermon_questions (
            id,
            question_text,
            question_order,
            is_private,
            placeholder_text
          )
        `).eq("is_active",!0).order("sermon_date",{ascending:!1}).order("question_order",{foreignTable:"sermon_questions",ascending:!0});if(t)throw t;return r.status(200).json({sermons:e})}if("POST"===e.method){if(!s)return r.status(401).json({error:"Authentication required"});if(!await (0,l.Cn)(s.id,s.email))return r.status(403).json({error:"Admin access required"});let{title:t,description:o,sermon_date:n,pastor_name:a,scripture_reference:i,questions:u=[]}=e.body;if(!t||!n)return r.status(400).json({error:"Title and sermon date are required"});let{data:c,error:m}=await d.from("sermons").insert({title:t,description:o,sermon_date:n,pastor_name:a,scripture_reference:i,created_by:s.id}).select().single();if(m)throw m;if(u.length>0){let e=u.map((e,r)=>({sermon_id:c.id,question_text:e.question_text,question_order:r+1,is_private:!1!==e.is_private,placeholder_text:e.placeholder_text||""})),{error:r}=await d.from("sermon_questions").insert(e);if(r)throw r}let{data:g,error:p}=await d.from("sermons").select(`
          *,
          sermon_questions (
            id,
            question_text,
            question_order,
            is_private,
            placeholder_text
          )
        `).eq("id",c.id).order("question_order",{foreignTable:"sermon_questions",ascending:!0}).single();if(p)throw p;return r.status(201).json({sermon:g})}return r.status(405).json({error:"Method not allowed"})}catch(e){return console.error("Sermons API error:",e),r.status(500).json({error:e.message||"Internal server error"})}}let m=(0,a.l)(o,"default"),g=(0,a.l)(o,"config"),p=new s.PagesAPIRouteModule({definition:{kind:n.x.PAGES_API,page:"/api/sermons",pathname:"/api/sermons",bundlePath:"",filename:""},userland:o})},8915:(e,r,t)=>{t.d(r,{Cn:()=>n,su:()=>a});var o=t(8456);let s=["admin@nbcc.com","pastor@nbcc.com","mppaul1458@gmail.com"],n=async(e,r)=>{try{let{data:t,error:n}=await o.OQ.from("users").select("is_admin, role").eq("id",e).single();if(!n&&t&&(!0===t.is_admin||"admin"===t.role))return!0;let a=s.includes(r.toLowerCase())||r.toLowerCase().includes("admin")||r.toLowerCase().includes("pastor");if(a&&e)try{await o.OQ.from("users").upsert({id:e,email:r,is_admin:!0,role:"admin"},{onConflict:"id",ignoreDuplicates:!1}),console.log("Updated admin status in database for:",r)}catch(e){console.warn("Could not update admin status in database:",e.message)}return a}catch(e){return console.warn("Admin status check failed:",e.message),s.includes(r.toLowerCase())||r.toLowerCase().includes("admin")||r.toLowerCase().includes("pastor")}},a=async e=>{try{console.log("Checking admin access for API route");let r=e.headers.authorization;if(console.log("Auth header present:",!!r),!r||!r.startsWith("Bearer "))return console.log("No valid authorization header found"),{user:null,error:"No authorization token provided"};let o=r.split(" ")[1];console.log("Token extracted, length:",o?.length);let{createClient:s}=await Promise.resolve().then(t.t.bind(t,2885,23)),a=s("https://qyhdzjzvkggcsuhnenaz.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY);console.log("Verifying JWT token...");let{data:{user:i},error:l}=await a.auth.getUser(o);if(l)return console.log("Token verification failed:",l.message),{user:null,error:`Invalid or expired token: ${l.message}`};if(!i)return console.log("No user found from token"),{user:null,error:"Invalid or expired token"};console.log("User verified:",i.email);let u=await n(i.id,i.email);if(console.log("Admin status:",u),!u)return console.log("User does not have admin privileges"),{user:null,error:"Admin privileges required"};return console.log("Admin access granted"),{user:i,error:null}}catch(e){return console.error("API admin access check failed:",e),{user:null,error:`Authentication failed: ${e.message}`}}}},8456:(e,r,t)=>{t.d(r,{OQ:()=>a});var o=t(2885);let s="https://qyhdzjzvkggcsuhnenaz.supabase.co",n="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InF5aGR6anp2a2dnY3N1aG5lbmF6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk0NjY1NzgsImV4cCI6MjA2NTA0MjU3OH0.wauN1JdrKCl82WFuwtCfq0oZVob8UEE71wjJw6otCFY";console.log("\uD83D\uDD0D Supabase Debug Info:"),console.log("URL:",s),console.log("Key exists:",!!n),console.log("Key length:",n?.length),console.log("âœ… Is Supabase configured:",!!(s&&n&&s.includes("supabase.co")&&n.length>50));let a=s&&n?(0,o.createClient)(s,n):null;console.log("\uD83D\uDE80 Supabase client created:",!!a)},7153:(e,r)=>{var t;Object.defineProperty(r,"x",{enumerable:!0,get:function(){return t}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(t||(t={}))},1802:(e,r,t)=>{e.exports=t(145)}};var r=require("../../webpack-api-runtime.js");r.C(e);var t=r(r.s=2789);module.exports=t})();